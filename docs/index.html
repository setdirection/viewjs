<!DOCTYPE html>
<html>
  <head>
    <title>ViewJS: Markup as JavaScript</title> 
    <link type="text/css" rel="stylesheet" href="stylesheets/syntax.css"/>
    <link type="text/css" rel="stylesheet" href="stylesheets/screen.css"/>
    <script type="text/javascript" src="javascripts/jquery.js"></script>
    <script type="text/javascript" src="javascripts/docs.js"></script>
    <script type="text/javascript" src="http://use.typekit.com/tqz3zpc.js"></script>
  </head> 
  <body> 
    <div id="content">
      <div id="main">
        <h1>ViewJS</h1><p class="npm">npm install view</p>
<ul id="nav">
  <li><a href="#intro">Intro</a></li>
  <li><a href="#view">Client</a></li>
  <li><a href="#viewserver">Server</a></li>
  <li><a href="https://github.com/syntacticx/viewjs/">Source</a></li>
</ul>
<a href="#" id="coffeescript"><span>Toggle</span></a>
<br class="clear">

<p>TODO: create JS that will hide all descriptions for quick API overview</p>

<h2>Concepts</h2>

<ul><li>Run JavaScript client or server</li><li>Mixin system (describe extend)</li></ul>

<h2>Installation</h2>

<pre class="highlighted"><div class="dp-highlighter nogutter"><ol start="true" class="coffeescript"><li class="alt"><span><span>mkdir project_name</span></span></li><li><span>cd project_name</span></li><li class="alt"><span>npm install view</span></li><li><span>node_modules/view/bin/bootstrap</span></li><li class="alt"><span>node app.js</span></li></ol></div><div class="dp-highlighter nogutter"><ol start="true" class="javascript"><li class="alt"><span><span>mkdir(project_name);</span></span></li><li><span>cd(project_name);</span></li><li class="alt"><span>npm(install(view));</span></li><li><span>node_modules / view / bin / bootstrap;</span></li><li class="alt"><span>node(app.js);</span></li></ol></div></pre>

<h2>Project Structure</h2>

<h2>Development</h2>

<pre class="highlighted"><div class="dp-highlighter nogutter"><ol start="true" class="coffeescript"><li class="alt"><span><span>cake watch</span></span></li></ol></div><div class="dp-highlighter nogutter"><ol start="true" class="javascript"><li class="alt"><span><span>cake(watch);</span></span></li></ol></div></pre>

<p>This will compile the following stylus and coffeescript files:</p>

<ul><li>stylesheets -&gt; public/stylesheets</li><li>models -&gt; public/javascripts/models</li><li>collections -&gt; public/javascripts/collections</li><li>controllers -&gt; public/javascripts/controllers</li><li>views -&gt; public/javascripts/views</li><li>templates -&gt; public/javascripts/templates.js</li></ul>

<h1>Client</h1>

<h2>View</h2>

<h3>View view_name</h3>

<p>Find a view by name:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>ContactView = View </span><span class="string">'ContactView'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> ContactView;</span></span></li><li><span>ContactView = View(<span class="string">'ContactView'</span><span>);</span></span></li></ol></div></pre>

<p>Passing in name: callback pairs will call the callback with the view as it's context when the view is created:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View</span></span></li><li><span>  ContactView: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    <span class="_this">@initialize</span><span>()</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View({</span></span></li><li><span> <span class="func_dec"> ContactView</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>    <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.initialize();</span></span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@create view_name: mixins</h3>

<p>Create a named view with the given mixins. You can pass a single mixin object, or an array of mixins. Nested arrays will be flattened.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.create ParentView:</span></span></li><li><span>  render: <span class="string">'parent.eco'</span><span></span></span></li><li class="alt"><span>  on:</span></li><li><span>    render: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>      console.log <span class="string">'ParentView on:render'</span><span></span></span></li><li><span></span></li><li class="alt"><span>View.create BuilderView: [Builder,</span></li><li><span>  render: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    <span class="_this">@div</span><span>()</span></span></li><li><span>]</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.create({</span></span></li><li><span>  ParentView: {</span></li><li class="alt"><span>    render: <span class="string">'parent.eco'</span><span>,</span></span></li><li><span>    on: {</span></li><li class="alt"><span>     <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>        <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'ParentView on:render'</span><span>);</span></span></li><li class="alt"><span>      }</span></li><li><span>    }</span></li><li class="alt"><span>  }</span></li><li><span>});</span></li><li class="alt"><span>View.create({</span></li><li><span>  BuilderView: [</span></li><li class="alt"><span>    Builder, {</span></li><li><span>     <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>        <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.div();</span></span></li><li><span>      }</span></li><li class="alt"><span>    }</span></li><li><span>  ]</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<p>Calling create on a named view creates a child view that will process all of the mixins of the parent view (effectively cloning it) in addition to the mixins passed into create:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>{ChildView} = ParentView.create ChildView:</span></span></li><li><span>  on:</span></li><li class="alt"><span>    render: <span class="func_dec">-&gt;</span><span></span></span></li><li><span>      console.log <span class="string">'ChildView on:render'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> ChildView;</span></span></li><li><span>ChildView = ParentView.create({</span></li><li class="alt"><span>  ChildView: {</span></li><li><span>    on: {</span></li><li class="alt"><span>     <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>        <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'ChildView on:render'</span><span>);</span></span></li><li class="alt"><span>      }</span></li><li><span>    }</span></li><li class="alt"><span>  }</span></li><li><span>}).ChildView;</span></li></ol></div></pre>

<p>Some mixin directives like <strong>render</strong> will overwrite an existing callback, while others like <strong>on</strong> will bind additional events without unregistering old events.</p>

<p>Calling create on a named view with no arguments creates an unnamed clone of the view.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><ol start="true" class="coffeescript"><li class="alt"><span><span>anonymous_view = ChildView.create()</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> anonymous_view;</span></span></li><li><span>anonymous_view = ChildView.create();</span></li></ol></div></pre>

<h3>@extend mixin</h3>

<p>All mixins passed to <strong>create()</strong> are then passed to <strong>extend</strong>. @extend looks for directives to process the attributes in the mixin (<strong>render</strong>,<strong>initialize</strong>,<strong>on</strong>, etc are all directives). If none are found the attribute becomes an attribute of the view.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>{PostView} = View.create PostView:</span></span></li><li><span>  render: <span class="string">'post.eco'</span><span> </span><span class="comment">#processed with render directive</span><span></span></span></li><li class="alt"><span>  key: <span class="string">'value'</span><span></span></span></li><li><span>PostView.key is <span class="string">'value'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> PostView;</span></span></li><li><span>PostView = View.create({</span></li><li class="alt"><span>  PostView: {</span></li><li><span>    render: <span class="string">'post.eco'</span><span>,</span></span></li><li class="alt"><span>    key: <span class="string">'value'</span><span></span></span></li><li><span>  }</span></li><li class="alt"><span>}).PostView;</span></li><li><span>PostView.key === <span class="string">'value'</span><span>;</span></span></li></ol></div></pre>

<h3>@extend extend: name</h3>

<p>Extend itself can be extended to process new directives. If you view the ViewJS source code you will see this is how ViewJS itself is constructed. The &quot;on&quot; directive is implemented roughly like this:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.extend extend:on: (events) </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>  <span class="keyword">for</span><span> event_name, callback of events</span></span></li><li class="alt"><span>    <span class="_this">@bind</span><span> event_name, callback</span></span></li><li><span></span></li><li class="alt"><span><span class="comment">#now &quot;on&quot; can be passed to extend</span><span></span></span></li><li><span>View.extend</span></li><li class="alt"><span>  on:</span></li><li><span>    render: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>      console.log <span class="string">'Called when any view renders'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.extend({</span></span></li><li><span>  extend: {</span></li><li class="alt"><span>   <span class="func_dec"> on</span><span>: </span><span class="keyword">function</span><span>(events) {</span></span></li><li><span>      <span class="keyword">var</span><span> callback, event_name, _results;</span></span></li><li class="alt"><span>      _results = [];</span></li><li><span>      <span class="keyword">for</span><span> (event_name </span><span class="keyword">in</span><span> events) {</span></span></li><li class="alt"><span>        callback = events[event_name];</span></li><li><span>        _results.<span class="support_method">push</span><span>(</span><span class="_this">this</span><span>.bind(event_name, callback));</span></span></li><li class="alt"><span>      }</span></li><li><span>      <span class="keyword">return</span><span> _results;</span></span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li><li><span>View.extend({</span></li><li class="alt"><span>  on: {</span></li><li><span>   <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>      <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'Called when any view renders'</span><span>);</span></span></li><li><span>    }</span></li><li class="alt"><span>  }</span></li><li><span>});</span></li></ol></div></pre>

<p>A <strong>discard</strong> callback is always passed as the second argument to a directive processor. Call this when a directive should only be processed once and not when child views are created. </p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.extend extend:routes: (routes,discard) </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>  <span class="comment">#process routes once then</span><span></span></span></li><li class="alt"><span>  discard()</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.extend({</span></span></li><li><span>  extend: {</span></li><li class="alt"><span>   <span class="func_dec"> routes</span><span>: </span><span class="keyword">function</span><span>(routes, discard) {</span></span></li><li><span>      <span class="keyword">return</span><span> discard();</span></span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@extend initialize: (next) -&gt;</h3>

<p>Add an asynchronous initialize callback to the view. <strong>The callback must call next</strong> or the view will never finish initializing. Note that initialize callbacks are added to a stack of existing callbacks. Child views specifying an initialize callback will not overwrite the parent's callback.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>{PostCollectionView} = View.create PostCollectionView:</span></span></li><li><span>  render: <span class="string">'post_preview.eco'</span><span></span></span></li><li class="alt"><span>  collection: PostCollection</span></li><li><span>  initialize: (next) <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    <span class="_this">@collection</span><span>.fetch success: next</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> PostCollectionView;</span></span></li><li><span>PostCollectionView = View.create({</span></li><li class="alt"><span>  PostCollectionView: {</span></li><li><span>    render: <span class="string">'post_preview.eco'</span><span>,</span></span></li><li class="alt"><span>    collection: PostCollection,</span></li><li><span>   <span class="func_dec"> initialize</span><span>: </span><span class="keyword">function</span><span>(next) {</span></span></li><li class="alt"><span>      <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.collection.fetch({</span></span></li><li><span>        success: next</span></li><li class="alt"><span>      });</span></li><li><span>    }</span></li><li class="alt"><span>  }</span></li><li><span>}).PostCollectionView;</span></li></ol></div></pre>

<h3>@initialize: attributes = {}, -&gt;</h3>

<p>Initializes a given view. Optional attributes will be passed to <strong>set()</strong> and an optional callback will be called when initialize is complete.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>$(</span><span class="string">'body'</span><span>).append PostCollectionView</span></span></li><li><span>PostCollectionView.initialize <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>  console.log <span class="string">'called when initialize is complete'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>$(</span><span class="string">'body'</span><span>).append(PostCollectionView);</span></span></li><li><span>PostCollectionView.initialize(<span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>  <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'called when initialize is complete'</span><span>);</span></span></li><li><span>});</span></li></ol></div></pre>

<h3>views: [views...]</h3>

<p>Specifies dependent views that will be loaded. Each dependent view add an <strong>initialize</strong> callback. The parent view will not finish initializing until the dependent views have finished initializing. Once finished the dependent view names will become available as properties of the parent view:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>{ApplicationView} = View.create ApplicationView: [Builder,</span></span></li><li><span>  views: [<span class="string">'PostCollectionView'</span><span>,</span><span class="string">'SideBarView'</span><span>]</span></span></li><li class="alt"><span>  render: <span class="func_dec">-&gt;</span><span></span></span></li><li><span>    <span class="_this">@div</span><span>(</span></span></li><li class="alt"><span>      <span class="_this">@div</span><span> class: </span><span class="string">'main'</span><span>, </span><span class="_this">@PostCollectionView</span><span></span></span></li><li><span>      <span class="_this">@div</span><span> class: </span><span class="string">'sidebar'</span><span>, </span><span class="_this">@SideBarView</span><span></span></span></li><li class="alt"><span>    )</span></li><li><span>]</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> ApplicationView;</span></span></li><li><span>ApplicationView = View.create({</span></li><li class="alt"><span>  ApplicationView: [</span></li><li><span>    Builder, {</span></li><li class="alt"><span>      views: [<span class="string">'PostCollectionView'</span><span>, </span><span class="string">'SideBarView'</span><span>],</span></span></li><li><span>     <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>        <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.div(</span><span class="_this">this</span><span>.div({</span></span></li><li><span>          <span class="string">"class"</span><span>: </span><span class="string">'main'</span><span>,</span></span></li><li class="alt"><span>          PostCollectionView: <span class="_this">this</span><span>.PostCollectionView</span></span></li><li><span>        }), <span class="_this">this</span><span>.div({</span></span></li><li class="alt"><span>          <span class="string">"class"</span><span>: </span><span class="string">'sidebar'</span><span>,</span></span></li><li><span>          SideBarView: <span class="_this">this</span><span>.SideBarView</span></span></li><li class="alt"><span>        }));</span></li><li><span>      }</span></li><li class="alt"><span>    }</span></li><li><span>  ]</span></li><li class="alt"><span>}).ApplicationView;</span></li></ol></div></pre>

<h2>Data</h2>

<h3>@extend model: Backbone.Model</h3>

<p>Specify a model for the view. Designed with Backbone.Model in mind, but can be any object that has an <strong>attributes</strong> property. The <strong>attributes</strong> property of the model will be passed as the context to a template if one is specified for the view. If using a callback with <strong>render</strong> the model will be accessed as <strong>@model</strong>.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>post = </span><span class="keyword">new</span><span> Backbone.Model title: </span><span class="string">'Post Title'</span><span></span></span></li><li><span>{PostView} = View.create PostView:</span></li><li class="alt"><span>  render: <span class="string">'post.eco'</span><span></span></span></li><li><span>  model: post</span></li><li class="alt"><span></span></li><li><span><span class="comment"># post.eco</span><span></span></span></li><li class="alt"><span><span class="comment"># &lt;h2&gt;&lt;%= @title %&gt;&lt;/h2&gt;</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> PostView, post;</span></span></li><li><span>post = <span class="keyword">new</span><span> Backbone.Model({</span></span></li><li class="alt"><span>  title: <span class="string">'Post Title'</span><span></span></span></li><li><span>});</span></li><li class="alt"><span>PostView = View.create({</span></li><li><span>  PostView: {</span></li><li class="alt"><span>    render: <span class="string">'post.eco'</span><span>,</span></span></li><li><span>    model: post</span></li><li class="alt"><span>  }</span></li><li><span>}).PostView;</span></li></ol></div></pre>

<h3>@extend collection: Backbone.Collection</h3>

<p><strong>render()</strong> will be called for each model in the collection, with the model as the context to a template, or as the first argument to a callback. Asynchronous collection logic must be put into an  <strong>initialize</strong> callback or a <strong>change</strong> or <strong>change:key</strong> event.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>{PostCollectionView} = View.create PostCollectionView:</span></span></li><li><span>  render: <span class="string">'post_preview.eco'</span><span></span></span></li><li class="alt"><span>  collection: PostCollection</span></li><li><span>  initialize: (next) <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    <span class="_this">@collection</span><span>.fetch success: next</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> PostCollectionView;</span></span></li><li><span>PostCollectionView = View.create({</span></li><li class="alt"><span>  PostCollectionView: {</span></li><li><span>    render: <span class="string">'post_preview.eco'</span><span>,</span></span></li><li class="alt"><span>    collection: PostCollection,</span></li><li><span>   <span class="func_dec"> initialize</span><span>: </span><span class="keyword">function</span><span>(next) {</span></span></li><li class="alt"><span>      <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.collection.fetch({</span></span></li><li><span>        success: next</span></li><li class="alt"><span>      });</span></li><li><span>    }</span></li><li class="alt"><span>  }</span></li><li><span>}).PostCollectionView;</span></li></ol></div></pre>

<p>collection is designed for use with a Backbone.Collection, but any class conforming to the following API will work:</p>

<ul><li>method: bind(event_name,listener)</li><li>event: all() </li><li>event: add(model)</li><li>event: remove(model) </li><li>event: refresh() </li></ul>

<h3>@get key</h3>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>title = PostView.model.get </span><span class="string">'title'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> title;</span></span></li><li><span>title = PostView.model.get(<span class="string">'title'</span><span>);</span></span></li></ol></div></pre>

<h3>@set attributes = {}, options = silent: false</h3>

<p>Set attributes on a view. By default this will trigger <strong>change</strong> and <strong>change:key</strong> events. Pass &quot;{silent:true}&quot; as the second argument to prevent those events from being triggered. Note that these attributes are not persisted to a view's model if present.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View PostView: </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>  <span class="_this">@on</span><span> change: </span><span class="func_dec">-&gt;</span><span> </span><span class="_this">@render</span><span>()</span></span></li><li class="alt"><span>  <span class="_this">@set</span><span> title: </span><span class="string">'Title One'</span><span> </span><span class="comment">#render() called</span><span></span></span></li><li><span>  <span class="_this">@set</span><span> {title: </span><span class="string">'Title Two'</span><span>}, {silent: </span><span class="constants">true</span><span>} </span><span class="comment">#render() not called</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View({</span></span></li><li><span> <span class="func_dec"> PostView</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>    <span class="_this">this</span><span>.on({</span></span></li><li><span>     <span class="func_dec"> change</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>        <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.render();</span></span></li><li><span>      }</span></li><li class="alt"><span>    });</span></li><li><span>    <span class="_this">this</span><span>.set({</span></span></li><li class="alt"><span>      title: <span class="string">'Title One'</span><span></span></span></li><li><span>    });</span></li><li class="alt"><span>    <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.set({</span></span></li><li><span>      title: <span class="string">'Title Two'</span><span></span></span></li><li class="alt"><span>    }, {</span></li><li><span>      silent: <span class="constants">true</span><span></span></span></li><li class="alt"><span>    });</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@name</h3>

<p>The name of the view.</p>

<h2>DOM</h2>

<h3>@extend $: Library</h3>

<p>Set the DOM library to use (currently jQuery or Zepto are the only supported libraries). Must be set on the base <strong>View</strong> object. A DOM library is not required to use ViewJS.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><ol start="true" class="coffeescript"><li class="alt"><span><span>View.extend</span></span></li><li><span>  $: jQuery</span></li></ol></div><div class="dp-highlighter nogutter"><ol start="true" class="javascript"><li class="alt"><span><span>View.extend({</span></span></li><li><span>  $: jQuery</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@$ selector</h3>

<p>When using a DOM library $ is available as a hybrid object and function. The function will act as the selector, and the object will contain all of the attributes of an Element wrapped by the DOM library (hide/show/addClass/etc). Note that the <strong>element</strong> object and $ method are always available, but the view will not contain any content until <strong>initialize</strong> has finished.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>PostView.$.hide() </span><span class="comment">#hide while loading</span><span></span></span></li><li><span>PostView.initialize <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>  @$.show()</span></li><li><span>  @$(<span class="string">'li'</span><span>).addClass </span><span class="string">'item'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>PostView.$.hide();</span></span></li><li><span>PostView.initialize(<span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>  <span class="_this">this</span><span>.$.show();</span></span></li><li><span>  <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.$(</span><span class="string">'li'</span><span>).addClass(</span><span class="string">'item'</span><span>);</span></span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@tag tag_name, attributes = {}, elements = [], content = '', -&gt;</h3>

<p>Generate a DOM Element. Accepts a variable number of hashes of attributes, elements, other views, strings of content or a functions to call, or arrays (which can be nested) of any of the above, in any order. If Builder is passed as a mixin all valid tag names become available as methods.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>{TableView} = View.create TableView: [Builder,</span></span></li><li><span>  render: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    <span class="_this">@table</span><span> cellpadding: </span><span class="constants">0</span><span>, cellspacing: </span><span class="constants">0</span><span>,</span></span></li><li><span>      <span class="_this">@tbody</span><span>(</span></span></li><li class="alt"><span>        <span class="_this">@tr</span><span>(</span></span></li><li><span>          <span class="_this">@td</span><span> </span><span class="string">'Cell One'</span><span></span></span></li><li class="alt"><span>          <span class="_this">@td</span><span> </span><span class="string">'Cell Two'</span><span></span></span></li><li><span>        )</span></li><li class="alt"><span>      )</span></li><li><span>]</span></li><li class="alt"><span></span></li><li><span><span class="comment">#without Builder</span><span></span></span></li><li class="alt"><span>{ListView} = View.create ListView:</span></li><li><span>  render: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    <span class="_this">@tag</span><span>(</span><span class="string">'ul'</span><span>,</span><span class="_this">@tag</span><span>(</span><span class="string">'li'</span><span>,</span><span class="string">'Item One'</span><span>))</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> ListView, TableView;</span></span></li><li><span>TableView = View.create({</span></li><li class="alt"><span>  TableView: [</span></li><li><span>    Builder, {</span></li><li class="alt"><span>     <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>        <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.table({</span></span></li><li class="alt"><span>          cellpadding: <span class="constants">0</span><span>,</span></span></li><li><span>          cellspacing: <span class="constants">0</span><span></span></span></li><li class="alt"><span>        }, <span class="_this">this</span><span>.tbody(</span><span class="_this">this</span><span>.tr(</span><span class="_this">this</span><span>.td(</span><span class="string">'Cell One'</span><span>), </span><span class="_this">this</span><span>.td(</span><span class="string">'Cell Two'</span><span>))));</span></span></li><li><span>      }</span></li><li class="alt"><span>    }</span></li><li><span>  ]</span></li><li class="alt"><span>}).TableView;</span></li><li><span>ListView = View.create({</span></li><li class="alt"><span>  ListView: {</span></li><li><span>   <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>      <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.tag(</span><span class="string">'ul'</span><span>, </span><span class="_this">this</span><span>.tag(</span><span class="string">'li'</span><span>, </span><span class="string">'Item One'</span><span>));</span></span></li><li><span>    }</span></li><li class="alt"><span>  }</span></li><li><span>}).ListView;</span></li></ol></div></pre>

<h3>@extend render: template</h3>

<p>Specify a template to render:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.create PostView:</span></span></li><li><span>  model: post</span></li><li class="alt"><span>  render: <span class="string">'post.eco'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.create({</span></span></li><li><span>  PostView: {</span></li><li class="alt"><span>    model: post,</span></li><li><span>    render: <span class="string">'post.eco'</span><span></span></span></li><li class="alt"><span>  }</span></li><li><span>});</span></li></ol></div></pre>

<h3>@extend render: -&gt;</h3>

<p>or pass a callback. Callbacks work best with <strong>Builder</strong>, but . Asynchronous logic  should be put inside of <strong>initialize</strong> or a <strong>change:key</strong> event handler.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.create PostView: [Builder,</span></span></li><li><span>  model: post</span></li><li class="alt"><span>  render: <span class="func_dec">-&gt;</span><span></span></span></li><li><span>    <span class="_this">@div</span><span> class: </span><span class="string">'post'</span><span>,</span></span></li><li class="alt"><span>      <span class="_this">@a</span><span>(</span><span class="string">'My Link'</span><span>,href: </span><span class="string">'#'</span><span>).click </span><span class="func_dec">-&gt;</span><span> </span><span class="constants">false</span><span></span></span></li><li><span>      <span class="_this">@h2</span><span> </span><span class="_this">@model</span><span>.get </span><span class="string">'title'</span><span></span></span></li><li class="alt"><span>]</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.create({</span></span></li><li><span>  PostView: [</span></li><li class="alt"><span>    Builder, {</span></li><li><span>      model: post,</span></li><li class="alt"><span>     <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>        <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.div({</span></span></li><li class="alt"><span>          <span class="string">"class"</span><span>: </span><span class="string">'post'</span><span></span></span></li><li><span>        }, <span class="_this">this</span><span>.a(</span><span class="string">'My Link'</span><span>, {</span></span></li><li class="alt"><span>          href: <span class="string">'#'</span><span></span></span></li><li><span>        }).<span class="support_method">click</span><span>(</span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>          <span class="keyword">return</span><span> </span><span class="constants">false</span><span>;</span></span></li><li><span>        }), <span class="_this">this</span><span>.h2(</span><span class="_this">this</span><span>.model.get(</span><span class="string">'title'</span><span>)));</span></span></li><li class="alt"><span>      }</span></li><li><span>    }</span></li><li class="alt"><span>  ]</span></li><li><span>});</span></li></ol></div></pre>

<h3>@render()</h3>

<p>render() is automatically called when <strong>initialize()</strong> has completed. Subsequent calls to render() will replace the contents of the view's <strong>element</strong>.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.create PostView:</span></span></li><li><span>  render: <span class="string">'post.eco'</span><span></span></span></li><li class="alt"><span>  on:</span></li><li><span>    change:</span></li><li class="alt"><span>      id: (id) <span class="func_dec">-&gt;</span><span></span></span></li><li><span>        Post.find id, (post) <span class="func_dec">=&gt;</span><span></span></span></li><li class="alt"><span>          <span class="_this">@model</span><span> = post</span></span></li><li><span>          <span class="_this">@render</span><span>()</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> __bind = </span><span class="keyword">function</span><span>(fn, me){ </span><span class="keyword">return</span><span> </span><span class="keyword">function</span><span>(){ </span><span class="keyword">return</span><span> fn.</span><span class="support_method">apply</span><span>(me, arguments); }; };</span></span></li><li><span>View.create({</span></li><li class="alt"><span>  PostView: {</span></li><li><span>    render: <span class="string">'post.eco'</span><span>,</span></span></li><li class="alt"><span>    on: {</span></li><li><span>      change: {</span></li><li class="alt"><span>       <span class="func_dec"> id</span><span>: </span><span class="keyword">function</span><span>(id) {</span></span></li><li><span>          <span class="keyword">return</span><span> Post.</span><span class="support_method">find</span><span>(id, __bind(</span><span class="keyword">function</span><span>(post) {</span></span></li><li class="alt"><span>            <span class="_this">this</span><span>.model = post;</span></span></li><li><span>            <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.render();</span></span></li><li class="alt"><span>          }, <span class="_this">this</span><span>));</span></span></li><li><span>        }</span></li><li class="alt"><span>      }</span></li><li><span>    }</span></li><li class="alt"><span>  }</span></li><li><span>});</span></li></ol></div></pre>

<h3>@extend helpers: template_helpers</h3>

<p>Adds helper methods to templates:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.extend helpers:</span></span></li><li><span>  url: (params) <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    <span class="_this">@url</span><span> params</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.extend({</span></span></li><li><span>  helpers: {</span></li><li class="alt"><span>   <span class="func_dec"> url</span><span>: </span><span class="keyword">function</span><span>(params) {</span></span></li><li><span>      <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.url(params);</span></span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@element</h3>

<p>The outer most DOM Element in the view which is available as soon as the view is created (before <strong>initialize</strong> or <strong>render</strong> are called). The Element is never removed even when the view is re-rendered.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>$(</span><span class="string">'body'</span><span>).append PostView</span></span></li><li><span>PostView.$.html() <span class="comment">#empty</span><span></span></span></li><li class="alt"><span>PostView.initialize <span class="func_dec">-&gt;</span><span></span></span></li><li><span>  @$.html() <span class="comment">#contents of post.eco</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>$(</span><span class="string">'body'</span><span>).append(PostView);</span></span></li><li><span>PostView.$.html();</span></li><li class="alt"><span>PostView.initialize(<span class="keyword">function</span><span>() {</span></span></li><li><span>  <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.$.html();</span></span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@extend element: -&gt; Element</h3>

<p>Override the default element which is a div with a className containing the <strong>name</strong> attribute of the view.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>{PostCollectionView} = View.create</span></span></li><li><span>  PostCollectionView: [Builder,</span></li><li class="alt"><span>    collection: PostCollection</span></li><li><span>    element: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>      <span class="_this">@ul</span><span>()</span></span></li><li><span>    render: (post) <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>      <span class="_this">@li</span><span> post.get </span><span class="string">'title'</span><span></span></span></li><li><span>  ]</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> PostCollectionView;</span></span></li><li><span>PostCollectionView = View.create({</span></li><li class="alt"><span>  PostCollectionView: [</span></li><li><span>    Builder, {</span></li><li class="alt"><span>      collection: PostCollection,</span></li><li><span>     <span class="func_dec"> element</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>        <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.ul();</span></span></li><li><span>      },</span></li><li class="alt"><span>     <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>(post) {</span></span></li><li><span>        <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.li(post.get(</span><span class="string">'title'</span><span>));</span></span></li><li class="alt"><span>      }</span></li><li><span>    }</span></li><li class="alt"><span>  ]</span></li><li><span>}).PostCollectionView;</span></li></ol></div></pre>

<h3>@extend delegate: events</h3>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.create PostView:</span></span></li><li><span>  delegate:</span></li><li class="alt"><span>    <span class="string">'click a.class'</span><span>: (</span><span class="builtin">event</span><span>) </span><span class="func_dec">-&gt;</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.create({</span></span></li><li><span>  PostView: {</span></li><li class="alt"><span>    delegate: {</span></li><li><span>      <span class="string">'click a.class'</span><span>: </span><span class="keyword">function</span><span>(</span><span class="builtin">event</span><span>) {}</span></span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@extend templates: template_name: -&gt;</h3>

<p><strong>ViewServer</strong> will automatically compile the contents of the <strong>templates</strong> directory and set this property accordingly, but if using <strong>View</strong> standalone this property should contain filename: callback pairs. The callbacks must return HTML strings and <strong>not</strong> DOM Elements. The <strong>templates</strong> attribute must be set on the base <strong>View</strong> object.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.extend</span></span></li><li><span>  templates:</span></li><li class="alt"><span>    <span class="string">'post.eco'</span><span>: (attributes) </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>      &quot;html output&quot;</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.extend({</span></span></li><li><span>  templates: {</span></li><li class="alt"><span>    <span class="string">'post.eco'</span><span>: </span><span class="keyword">function</span><span>(attributes) {</span></span></li><li><span>      <span class="keyword">return</span><span> </span><span class="string">"html output"</span><span>;</span></span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h2>Events</h2>

<h3>@bind event_name, callback</h3>

<h3>@on event_name, callback</h3>

<p>Bind a callback to an event. <strong>bind</strong> and <strong>on</strong> are aliases.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>PostView.bind </span><span class="string">'render'</span><span>, </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>  console.log <span class="string">'Post rendered'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>PostView.bind(</span><span class="string">'render'</span><span>, </span><span class="keyword">function</span><span>() {</span></span></li><li><span>  <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'Post rendered'</span><span>);</span></span></li><li class="alt"><span>});</span></li></ol></div></pre>

<p>An object containing event name, callback pairs can also be used:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>PostView.on</span></span></li><li><span>  render: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    console.log <span class="string">'Post rendered'</span><span></span></span></li><li><span>  initialize: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    console.log <span class="string">'Post initialized'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>PostView.on({</span></span></li><li><span> <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>    <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'Post rendered'</span><span>);</span></span></li><li><span>  },</span></li><li class="alt"><span> <span class="func_dec"> initialize</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>    <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'Post initialized'</span><span>);</span></span></li><li class="alt"><span>  }</span></li><li><span>});</span></li></ol></div></pre>

<h3>@extend on: events</h3>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>PostView.extend</span></span></li><li><span>  on:</span></li><li class="alt"><span>    render: <span class="func_dec">-&gt;</span><span></span></span></li><li><span>      console.log <span class="string">'Post rendered'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>PostView.extend({</span></span></li><li><span>  on: {</span></li><li class="alt"><span>   <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>      <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'Post rendered'</span><span>);</span></span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@unbind/removeListener event_name = false, handler = -&gt;</h3>

<h3>@trigger/emit event_name, args...</h3>

<h3>@before: method_name: (original_method) -&gt;</h3>

<h4>change: -&gt;</h4>

<h4>change:key: (value) -&gt;</h4>

<h4>ready: -&gt;</h4>

<h4>activated: -&gt;</h4>

<h4>deactivated: -&gt;</h4>

<h4>error: (error) -&gt;</h4>

<h4>warning: (warning)</h4>

<h2>Env</h2>

<h3>@env: env_name: -&gt;</h3>

<h4>server</h4>

<h4>client</h4>

<h4>browser</h4>

<h2>Routes</h2>

<h3>routes: path: view_name</h3>

<h3>url = @url view_name: attributes: {}</h3>

<h2>Mixins</h2>

<h3>Builder</h3>

<h3>Router</h3>

<h1>ViewServer</h1>

<h2>ViewServer</h2>

<h3>{ViewServer} = ViewServer server_name: -&gt;</h3>

<h3>{ViewServer} = @create server_name: mixins = {}</h3>

<h2>Server</h2>

<h3>server: express_instance</h3>

<h3>port: number</h3>

<h3>templates: path</h3>

<h3>public: path</h3>

<h2>Assets</h2>

<h3>@javascripts: [javascripts...]</h3>

<h3>@execute: [execute...]</h3>

<h3>@stylesheets: [stylesheets...]</h3>

<h2>Events</h2>

<h3>@bind/on: event_name, (args...) -&gt;</h3>

<h3>@unbind/removeListener event_name = false, handler = -&gt;</h3>

<h3>@trigger/emit event_name, args...</h3>

<h4>window:created (window) -&gt;</h4>

<h4>window:render (window,request) -&gt;</h4>

<h4>error: (error) -&gt;</h4>

<h4>warning: (warning)</h4>

<h2>Env</h2>

<h3>@env: env_name: -&gt;</h3>

<h2>Routes</h2>

<h3>routes: path: view_name</h3>

<h2>Cache</h2>

<h3>cache: [views...]</h3>
      </div>
    </div>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-20694546-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>