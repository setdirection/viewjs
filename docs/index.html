<!DOCTYPE html>
<html>
  <head>
    <title>ViewJS: Markup as JavaScript</title> 
    <link type="text/css" rel="stylesheet" href="stylesheets/syntax.css"/>
    <link type="text/css" rel="stylesheet" href="stylesheets/screen.css"/>
    <script type="text/javascript" src="javascripts/jquery.js"></script>
    <script type="text/javascript" src="javascripts/docs.js"></script>
    <script type="text/javascript" src="http://use.typekit.com/tqz3zpc.js"></script>
  </head> 
  <body> 
    <div id="content">
      <div id="main">
        <h1>ViewJS</h1><ul id="nav">
  <li><a href="#" id="intro">Intro</a></li>
  <li><a href="#" id="client">Client</a></li>
  <li><a href="#" id="server">Server</a></li>
  <li><a href="https://github.com/syntacticx/viewjs/">Source</a></li>
</ul>
<a href="#" id="coffeescript"><span>Toggle</span></a>
<a href="#" id="coffeescript"><span>Toggle</span></a>
<br class="clear">

<p>TODO: create JS that will hide all descriptions for quick API overview</p>

<h2>Concepts</h2>

<ul><li>Run JavaScript client or server</li><li>Mixin system (describe extend)</li><li>Builder + inline jQuery</li></ul>

<h2>Installation</h2>

<pre class="highlighted"><div class="dp-highlighter nogutter"><ol start="true" class="coffeescript"><li class="alt"><span><span>mkdir project_name</span></span></li><li><span>cd project_name</span></li><li class="alt"><span>npm install view</span></li><li><span>node_modules/view/bin/bootstrap</span></li><li class="alt"><span>node app.js</span></li></ol></div><div class="dp-highlighter nogutter"><ol start="true" class="javascript"><li class="alt"><span><span>mkdir(project_name);</span></span></li><li><span>cd(project_name);</span></li><li class="alt"><span>npm(install(view));</span></li><li><span>node_modules / view / bin / bootstrap;</span></li><li class="alt"><span>node(app.js);</span></li></ol></div></pre>

<h2>Project Structure</h2>

<h2>Development</h2>

<p>Run this command from your project:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><ol start="true" class="coffeescript"><li class="alt"><span><span>cake watch</span></span></li></ol></div><div class="dp-highlighter nogutter"><ol start="true" class="javascript"><li class="alt"><span><span>cake(watch);</span></span></li></ol></div></pre>

<p>This will compile the following stylus and coffeescript files:</p>

<ul><li>stylesheets -&gt; public/stylesheets</li><li>models -&gt; public/javascripts/models</li><li>collections -&gt; public/javascripts/collections</li><li>controllers -&gt; public/javascripts/controllers</li><li>views -&gt; public/javascripts/views</li><li>templates -&gt; public/javascripts/templates.js</li></ul>

<p><strong>Note that you need to restart the cake watch process when you create new files, this will be automatic in the future.</strong></p>

<h1>Client</h1>

<h2>View</h2>

<p>The View class represents a DOM Element, a set of behaviors associated with it (event handlers, custom initializers, custom methods, etc) and possibly a Model or Collection that is bound to the view. All views are mixins and can be extended and sub classed at any time.</p>

<h3>View view_name</h3>

<p>Find a view by name:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>ContactView = View </span><span class="string">'ContactView'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> ContactView;</span></span></li><li><span>ContactView = View(<span class="string">'ContactView'</span><span>);</span></span></li></ol></div></pre>

<h3>View view_name: -&gt;</h3>

<p>Passing in name: callback pairs will call the callback with the view as it's context when the view is available:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View</span></span></li><li><span>  ContactView: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    <span class="_this">@initialize</span><span>()</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View({</span></span></li><li><span> <span class="func_dec"> ContactView</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>    <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.initialize();</span></span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@create view_name: mixins</h3>

<p>Create a named view with the given mixins. You can pass a single mixin object, or an array of mixins. Nested arrays will be flattened.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.create ParentView:</span></span></li><li><span>  render: <span class="string">'parent.eco'</span><span></span></span></li><li class="alt"><span>  on:</span></li><li><span>    render: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>      console.log <span class="string">'render event triggered'</span><span></span></span></li><li><span></span></li><li class="alt"><span>View.create BuilderView: [Builder,</span></li><li><span>  render: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    <span class="_this">@div</span><span>()</span></span></li><li><span>]</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.create({</span></span></li><li><span>  ParentView: {</span></li><li class="alt"><span>    render: <span class="string">'parent.eco'</span><span>,</span></span></li><li><span>    on: {</span></li><li class="alt"><span>     <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>        <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'render event triggered'</span><span>);</span></span></li><li class="alt"><span>      }</span></li><li><span>    }</span></li><li class="alt"><span>  }</span></li><li><span>});</span></li><li class="alt"><span>View.create({</span></li><li><span>  BuilderView: [</span></li><li class="alt"><span>    Builder, {</span></li><li><span>     <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>        <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.div();</span></span></li><li><span>      }</span></li><li class="alt"><span>    }</span></li><li><span>  ]</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<p>Calling create on a named view creates a child view that will process all of the mixins of the parent view (effectively cloning it) in addition to the mixins passed into create:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>{ChildView} = ParentView.create ChildView:</span></span></li><li><span>  render: <span class="string">'child.eco'</span><span></span></span></li><li class="alt"><span>  on:</span></li><li><span>    render: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>      console.log <span class="string">'render event triggered'</span><span></span></span></li><li><span>    <span class="comment">#render now has two event handlers</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> ChildView;</span></span></li><li><span>ChildView = ParentView.create({</span></li><li class="alt"><span>  ChildView: {</span></li><li><span>    render: <span class="string">'child.eco'</span><span>,</span></span></li><li class="alt"><span>    on: {</span></li><li><span>     <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>        <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'render event triggered'</span><span>);</span></span></li><li><span>      }</span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>}).ChildView;</span></li></ol></div></pre>

<p>Some mixin directives like <strong>render</strong> will overwrite an existing callback, while others like <strong>on</strong> will bind additional events without unregistering old events.</p>

<p>Calling create on a named view with no arguments creates an unnamed clone of the view.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><ol start="true" class="coffeescript"><li class="alt"><span><span>anonymous_view = ChildView.create()</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> anonymous_view;</span></span></li><li><span>anonymous_view = ChildView.create();</span></li></ol></div></pre>

<h3>@extend mixin</h3>

<p>All mixins passed to <strong>create()</strong> are then passed to <strong>extend</strong>. @extend looks for directives to process the attributes in the mixin (<strong>render</strong>,<strong>initialize</strong>,<strong>on</strong>, etc are all directives). If none are found the attribute becomes an attribute of the view.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>{PostView} = View.create PostView:</span></span></li><li><span>  render: <span class="string">'post.eco'</span><span> </span><span class="comment">#processed with render directive</span><span></span></span></li><li class="alt"><span>  key: <span class="string">'value'</span><span></span></span></li><li><span>PostView.key is <span class="string">'value'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> PostView;</span></span></li><li><span>PostView = View.create({</span></li><li class="alt"><span>  PostView: {</span></li><li><span>    render: <span class="string">'post.eco'</span><span>,</span></span></li><li class="alt"><span>    key: <span class="string">'value'</span><span></span></span></li><li><span>  }</span></li><li class="alt"><span>}).PostView;</span></li><li><span>PostView.key === <span class="string">'value'</span><span>;</span></span></li></ol></div></pre>

<h3>@extend extend: directive_name: (directive_value) -&gt;</h3>

<p>Extend itself can be extended to process new directives. If you view the ViewJS source code you will see this is how ViewJS itself is constructed. The &quot;on&quot; directive is implemented roughly like this:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.extend extend:on: (events) </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>  <span class="keyword">for</span><span> event_name, callback of events</span></span></li><li class="alt"><span>    <span class="_this">@bind</span><span> event_name, callback</span></span></li><li><span></span></li><li class="alt"><span><span class="comment">#now &quot;on&quot; can be passed to extend</span><span></span></span></li><li><span>View.extend</span></li><li class="alt"><span>  on:</span></li><li><span>    render: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>      console.log <span class="string">'Called when any view renders'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.extend({</span></span></li><li><span>  extend: {</span></li><li class="alt"><span>   <span class="func_dec"> on</span><span>: </span><span class="keyword">function</span><span>(events) {</span></span></li><li><span>      <span class="keyword">var</span><span> callback, event_name, _results;</span></span></li><li class="alt"><span>      _results = [];</span></li><li><span>      <span class="keyword">for</span><span> (event_name </span><span class="keyword">in</span><span> events) {</span></span></li><li class="alt"><span>        callback = events[event_name];</span></li><li><span>        _results.<span class="support_method">push</span><span>(</span><span class="_this">this</span><span>.bind(event_name, callback));</span></span></li><li class="alt"><span>      }</span></li><li><span>      <span class="keyword">return</span><span> _results;</span></span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li><li><span>View.extend({</span></li><li class="alt"><span>  on: {</span></li><li><span>   <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>      <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'Called when any view renders'</span><span>);</span></span></li><li><span>    }</span></li><li class="alt"><span>  }</span></li><li><span>});</span></li></ol></div></pre>

<p>A <strong>discard</strong> callback is always passed as the second argument to a directive processor. Call this when a directive should only be processed once and not when child views are created. </p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.extend extend:routes: (routes,discard) </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>  <span class="comment">#process routes once then</span><span></span></span></li><li class="alt"><span>  discard()</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.extend({</span></span></li><li><span>  extend: {</span></li><li class="alt"><span>   <span class="func_dec"> routes</span><span>: </span><span class="keyword">function</span><span>(routes, discard) {</span></span></li><li><span>      <span class="keyword">return</span><span> discard();</span></span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@extend initialize: (next) -&gt;</h3>

<p>Add an asynchronous initialize callback to the view. <strong>The callback must call next</strong> or the view will never finish initializing. Note that initialize callbacks are added to a stack of existing callbacks. Child views specifying an initialize callback will not overwrite the parent's callback.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>{PostCollectionView} = View.create PostCollectionView:</span></span></li><li><span>  render: <span class="string">'post_preview.eco'</span><span></span></span></li><li class="alt"><span>  collection: PostCollection</span></li><li><span>  initialize: (next) <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    <span class="_this">@collection</span><span>.fetch success: next</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> PostCollectionView;</span></span></li><li><span>PostCollectionView = View.create({</span></li><li class="alt"><span>  PostCollectionView: {</span></li><li><span>    render: <span class="string">'post_preview.eco'</span><span>,</span></span></li><li class="alt"><span>    collection: PostCollection,</span></li><li><span>   <span class="func_dec"> initialize</span><span>: </span><span class="keyword">function</span><span>(next) {</span></span></li><li class="alt"><span>      <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.collection.fetch({</span></span></li><li><span>        success: next</span></li><li class="alt"><span>      });</span></li><li><span>    }</span></li><li class="alt"><span>  }</span></li><li><span>}).PostCollectionView;</span></li></ol></div></pre>

<h3>@initialize: attributes = {}, -&gt;</h3>

<p>Initializes a given view. Optional attributes will be passed to <strong>set()</strong> and an optional callback will be called when initialize is complete.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>$(</span><span class="string">'body'</span><span>).append PostCollectionView</span></span></li><li><span>PostCollectionView.initialize <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>  console.log <span class="string">'called when initialize is complete'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>$(</span><span class="string">'body'</span><span>).append(PostCollectionView);</span></span></li><li><span>PostCollectionView.initialize(<span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>  <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'called when initialize is complete'</span><span>);</span></span></li><li><span>});</span></li></ol></div></pre>

<h3>@extend views: [views...]</h3>

<p>Specifies dependent views that will be loaded. Each dependent view add an <strong>initialize</strong> callback. The parent view will not finish initializing until the dependent views have finished initializing. Once finished the dependent view names will become available as properties of the parent view:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>{ApplicationView} = View.create ApplicationView: [Builder,</span></span></li><li><span>  views: [<span class="string">'PostCollectionView'</span><span>,</span><span class="string">'SideBarView'</span><span>]</span></span></li><li class="alt"><span>  render: <span class="func_dec">-&gt;</span><span></span></span></li><li><span>    <span class="_this">@div</span><span>(</span></span></li><li class="alt"><span>      <span class="_this">@div</span><span> class: </span><span class="string">'main'</span><span>, </span><span class="_this">@PostCollectionView</span><span></span></span></li><li><span>      <span class="_this">@div</span><span> class: </span><span class="string">'sidebar'</span><span>, </span><span class="_this">@SideBarView</span><span></span></span></li><li class="alt"><span>    )</span></li><li><span>]</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> ApplicationView;</span></span></li><li><span>ApplicationView = View.create({</span></li><li class="alt"><span>  ApplicationView: [</span></li><li><span>    Builder, {</span></li><li class="alt"><span>      views: [<span class="string">'PostCollectionView'</span><span>, </span><span class="string">'SideBarView'</span><span>],</span></span></li><li><span>     <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>        <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.div(</span><span class="_this">this</span><span>.div({</span></span></li><li><span>          <span class="string">"class"</span><span>: </span><span class="string">'main'</span><span>,</span></span></li><li class="alt"><span>          PostCollectionView: <span class="_this">this</span><span>.PostCollectionView</span></span></li><li><span>        }), <span class="_this">this</span><span>.div({</span></span></li><li class="alt"><span>          <span class="string">"class"</span><span>: </span><span class="string">'sidebar'</span><span>,</span></span></li><li><span>          SideBarView: <span class="_this">this</span><span>.SideBarView</span></span></li><li class="alt"><span>        }));</span></li><li><span>      }</span></li><li class="alt"><span>    }</span></li><li><span>  ]</span></li><li class="alt"><span>}).ApplicationView;</span></li></ol></div></pre>

<h2>Data</h2>

<h3>@extend model: Backbone.Model</h3>

<p>Specify a model for the view. Designed with Backbone.Model in mind, but can be any object that has an <strong>attributes</strong> property. The <strong>attributes</strong> property of the model will be passed as the context to a template if one is specified for the view. If using a callback with <strong>render</strong> the model will be accessed as <strong>@model</strong>.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>post = </span><span class="keyword">new</span><span> Backbone.Model title: </span><span class="string">'Post Title'</span><span></span></span></li><li><span>{PostView} = View.create PostView:</span></li><li class="alt"><span>  render: <span class="string">'post.eco'</span><span></span></span></li><li><span>  model: post</span></li><li class="alt"><span></span></li><li><span><span class="comment"># post.eco</span><span></span></span></li><li class="alt"><span><span class="comment"># &lt;h2&gt;&lt;%= @title %&gt;&lt;/h2&gt;</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> PostView, post;</span></span></li><li><span>post = <span class="keyword">new</span><span> Backbone.Model({</span></span></li><li class="alt"><span>  title: <span class="string">'Post Title'</span><span></span></span></li><li><span>});</span></li><li class="alt"><span>PostView = View.create({</span></li><li><span>  PostView: {</span></li><li class="alt"><span>    render: <span class="string">'post.eco'</span><span>,</span></span></li><li><span>    model: post</span></li><li class="alt"><span>  }</span></li><li><span>}).PostView;</span></li></ol></div></pre>

<h3>@extend collection: Backbone.Collection</h3>

<p><strong>render()</strong> will be called for each model in the collection, with the model as the context to a template, or as the first argument to a callback. Asynchronous collection logic must be put into an  <strong>initialize</strong> callback or a <strong>change</strong> or <strong>change:key</strong> event.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>{PostCollectionView} = View.create PostCollectionView:</span></span></li><li><span>  render: <span class="string">'post_preview.eco'</span><span></span></span></li><li class="alt"><span>  collection: PostCollection</span></li><li><span>  initialize: (next) <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    <span class="_this">@collection</span><span>.fetch success: next</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> PostCollectionView;</span></span></li><li><span>PostCollectionView = View.create({</span></li><li class="alt"><span>  PostCollectionView: {</span></li><li><span>    render: <span class="string">'post_preview.eco'</span><span>,</span></span></li><li class="alt"><span>    collection: PostCollection,</span></li><li><span>   <span class="func_dec"> initialize</span><span>: </span><span class="keyword">function</span><span>(next) {</span></span></li><li class="alt"><span>      <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.collection.fetch({</span></span></li><li><span>        success: next</span></li><li class="alt"><span>      });</span></li><li><span>    }</span></li><li class="alt"><span>  }</span></li><li><span>}).PostCollectionView;</span></li></ol></div></pre>

<p>collection is designed for use with a Backbone.Collection, but any class conforming to the following API will work:</p>

<ul><li>method: bind(event_name,listener)</li><li>event: all() </li><li>event: add(model)</li><li>event: remove(model) </li><li>event: refresh() </li></ul>

<h3>@get key</h3>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>title = PostView.model.get </span><span class="string">'title'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> title;</span></span></li><li><span>title = PostView.model.get(<span class="string">'title'</span><span>);</span></span></li></ol></div></pre>

<h3>@set attributes = {}, options = silent: false</h3>

<p>Set attributes on a view. By default this will trigger <strong>change</strong> and <strong>change:key</strong> events. Pass &quot;{silent:true}&quot; as the second argument to prevent those events from being triggered. Note that these attributes are not persisted to a view's model if present.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View PostView: </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>  <span class="_this">@on</span><span> change: </span><span class="func_dec">-&gt;</span><span> </span><span class="_this">@render</span><span>()</span></span></li><li class="alt"><span>  <span class="_this">@set</span><span> title: </span><span class="string">'Title One'</span><span> </span><span class="comment">#render() called</span><span></span></span></li><li><span>  <span class="_this">@set</span><span> {title: </span><span class="string">'Title Two'</span><span>}, {silent: </span><span class="constants">true</span><span>} </span><span class="comment">#render() not called</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View({</span></span></li><li><span> <span class="func_dec"> PostView</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>    <span class="_this">this</span><span>.on({</span></span></li><li><span>     <span class="func_dec"> change</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>        <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.render();</span></span></li><li><span>      }</span></li><li class="alt"><span>    });</span></li><li><span>    <span class="_this">this</span><span>.set({</span></span></li><li class="alt"><span>      title: <span class="string">'Title One'</span><span></span></span></li><li><span>    });</span></li><li class="alt"><span>    <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.set({</span></span></li><li><span>      title: <span class="string">'Title Two'</span><span></span></span></li><li class="alt"><span>    }, {</span></li><li><span>      silent: <span class="constants">true</span><span></span></span></li><li class="alt"><span>    });</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@name</h3>

<p>The name of the view.</p>

<h2>DOM</h2>

<h3>@extend $: Library</h3>

<p>Set the DOM library to use (currently jQuery or Zepto are the only supported libraries). Must be set on the base <strong>View</strong> object. A DOM library is not required to use ViewJS.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><ol start="true" class="coffeescript"><li class="alt"><span><span>View.extend</span></span></li><li><span>  $: jQuery</span></li></ol></div><div class="dp-highlighter nogutter"><ol start="true" class="javascript"><li class="alt"><span><span>View.extend({</span></span></li><li><span>  $: jQuery</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@$ selector</h3>

<p>When using a DOM library $ is available as a hybrid object and function. The function will act as the selector, and the object will contain all of the attributes of an Element wrapped by the DOM library (hide/show/addClass/etc). Note that the <strong>element</strong> object and $ method are always available, but the view will not contain any content until <strong>initialize</strong> has finished.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>PostView.$.hide() </span><span class="comment">#hide while loading</span><span></span></span></li><li><span>PostView.initialize <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>  @$.show()</span></li><li><span>  @$(<span class="string">'li'</span><span>).addClass </span><span class="string">'item'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>PostView.$.hide();</span></span></li><li><span>PostView.initialize(<span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>  <span class="_this">this</span><span>.$.show();</span></span></li><li><span>  <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.$(</span><span class="string">'li'</span><span>).addClass(</span><span class="string">'item'</span><span>);</span></span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@tag tag_name, attributes = {}, elements = [], content = '', -&gt;</h3>

<p>Generate a DOM Element. Accepts a variable number of hashes of attributes, elements, other views, strings of content or a functions to call, or arrays (which can be nested) of any of the above, in any order. If Builder is passed as a mixin all valid tag names become available as methods.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>{TableView} = View.create TableView: [Builder,</span></span></li><li><span>  render: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    <span class="_this">@table</span><span> cellpadding: </span><span class="constants">0</span><span>, cellspacing: </span><span class="constants">0</span><span>,</span></span></li><li><span>      <span class="_this">@tbody</span><span>(</span></span></li><li class="alt"><span>        <span class="_this">@tr</span><span>(</span></span></li><li><span>          <span class="_this">@td</span><span> </span><span class="string">'Cell One'</span><span></span></span></li><li class="alt"><span>          <span class="_this">@td</span><span> </span><span class="string">'Cell Two'</span><span></span></span></li><li><span>        )</span></li><li class="alt"><span>      )</span></li><li><span>]</span></li><li class="alt"><span></span></li><li><span><span class="comment">#without Builder</span><span></span></span></li><li class="alt"><span>{ListView} = View.create ListView:</span></li><li><span>  render: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    <span class="_this">@tag</span><span>(</span><span class="string">'ul'</span><span>,</span><span class="_this">@tag</span><span>(</span><span class="string">'li'</span><span>,</span><span class="string">'Item One'</span><span>))</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> ListView, TableView;</span></span></li><li><span>TableView = View.create({</span></li><li class="alt"><span>  TableView: [</span></li><li><span>    Builder, {</span></li><li class="alt"><span>     <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>        <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.table({</span></span></li><li class="alt"><span>          cellpadding: <span class="constants">0</span><span>,</span></span></li><li><span>          cellspacing: <span class="constants">0</span><span></span></span></li><li class="alt"><span>        }, <span class="_this">this</span><span>.tbody(</span><span class="_this">this</span><span>.tr(</span><span class="_this">this</span><span>.td(</span><span class="string">'Cell One'</span><span>), </span><span class="_this">this</span><span>.td(</span><span class="string">'Cell Two'</span><span>))));</span></span></li><li><span>      }</span></li><li class="alt"><span>    }</span></li><li><span>  ]</span></li><li class="alt"><span>}).TableView;</span></li><li><span>ListView = View.create({</span></li><li class="alt"><span>  ListView: {</span></li><li><span>   <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>      <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.tag(</span><span class="string">'ul'</span><span>, </span><span class="_this">this</span><span>.tag(</span><span class="string">'li'</span><span>, </span><span class="string">'Item One'</span><span>));</span></span></li><li><span>    }</span></li><li class="alt"><span>  }</span></li><li><span>}).ListView;</span></li></ol></div></pre>

<p>If a DOM library is present @tag and Builder methods will instead return a wrapped object containing the element (i.e. a jQuery or Zepto array). View will always look inside these objects for the actual elements so in practice you can use them as if they were the Element objects, with the added benefit of attaching event handlers inline, etc:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span class="_this">@ul</span><span> </span><span class="_this">@li</span><span> </span><span class="_this">@a</span><span>(</span><span class="string">'Link'</span><span>,href:</span><span class="string">'#'</span><span>).click </span><span class="func_dec">-&gt;</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="_this">this</span><span>.ul(</span><span class="_this">this</span><span>.li(</span><span class="_this">this</span><span>.a(</span><span class="string">'Link'</span><span>, {</span></span></li><li><span>  href: <span class="string">'#'</span><span></span></span></li><li class="alt"><span>}).<span class="support_method">click</span><span>(</span><span class="keyword">function</span><span>() {})));</span></span></li></ol></div></pre>

<h3>@extend render: template</h3>

<p>Specify a template to render:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.create PostView:</span></span></li><li><span>  model: post</span></li><li class="alt"><span>  render: <span class="string">'post.eco'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.create({</span></span></li><li><span>  PostView: {</span></li><li class="alt"><span>    model: post,</span></li><li><span>    render: <span class="string">'post.eco'</span><span></span></span></li><li class="alt"><span>  }</span></li><li><span>});</span></li></ol></div></pre>

<h3>@extend render: -&gt;</h3>

<p>or pass a callback. Callbacks work best with <strong>Builder</strong>, but . Asynchronous logic  should be put inside of <strong>initialize</strong> or a <strong>change:key</strong> event handler.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.create PostView: [Builder,</span></span></li><li><span>  model: post</span></li><li class="alt"><span>  render: <span class="func_dec">-&gt;</span><span></span></span></li><li><span>    <span class="_this">@div</span><span> class: </span><span class="string">'post'</span><span>,</span></span></li><li class="alt"><span>      <span class="_this">@a</span><span>(</span><span class="string">'My Link'</span><span>,href: </span><span class="string">'#'</span><span>).click </span><span class="func_dec">-&gt;</span><span> </span><span class="constants">false</span><span></span></span></li><li><span>      <span class="_this">@h2</span><span> </span><span class="_this">@model</span><span>.get </span><span class="string">'title'</span><span></span></span></li><li class="alt"><span>]</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.create({</span></span></li><li><span>  PostView: [</span></li><li class="alt"><span>    Builder, {</span></li><li><span>      model: post,</span></li><li class="alt"><span>     <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>        <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.div({</span></span></li><li class="alt"><span>          <span class="string">"class"</span><span>: </span><span class="string">'post'</span><span></span></span></li><li><span>        }, <span class="_this">this</span><span>.a(</span><span class="string">'My Link'</span><span>, {</span></span></li><li class="alt"><span>          href: <span class="string">'#'</span><span></span></span></li><li><span>        }).<span class="support_method">click</span><span>(</span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>          <span class="keyword">return</span><span> </span><span class="constants">false</span><span>;</span></span></li><li><span>        }), <span class="_this">this</span><span>.h2(</span><span class="_this">this</span><span>.model.get(</span><span class="string">'title'</span><span>)));</span></span></li><li class="alt"><span>      }</span></li><li><span>    }</span></li><li class="alt"><span>  ]</span></li><li><span>});</span></li></ol></div></pre>

<h3>@render()</h3>

<p>render() is automatically called when <strong>initialize()</strong> has completed. Subsequent calls to render() will replace the contents of the view's <strong>element</strong>.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.create PostView:</span></span></li><li><span>  render: <span class="string">'post.eco'</span><span></span></span></li><li class="alt"><span>  on:</span></li><li><span>    change:</span></li><li class="alt"><span>      id: (id) <span class="func_dec">-&gt;</span><span></span></span></li><li><span>        Post.find id, (post) <span class="func_dec">=&gt;</span><span></span></span></li><li class="alt"><span>          <span class="_this">@model</span><span> = post</span></span></li><li><span>          <span class="_this">@render</span><span>()</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> __bind = </span><span class="keyword">function</span><span>(fn, me){ </span><span class="keyword">return</span><span> </span><span class="keyword">function</span><span>(){ </span><span class="keyword">return</span><span> fn.</span><span class="support_method">apply</span><span>(me, arguments); }; };</span></span></li><li><span>View.create({</span></li><li class="alt"><span>  PostView: {</span></li><li><span>    render: <span class="string">'post.eco'</span><span>,</span></span></li><li class="alt"><span>    on: {</span></li><li><span>      change: {</span></li><li class="alt"><span>       <span class="func_dec"> id</span><span>: </span><span class="keyword">function</span><span>(id) {</span></span></li><li><span>          <span class="keyword">return</span><span> Post.</span><span class="support_method">find</span><span>(id, __bind(</span><span class="keyword">function</span><span>(post) {</span></span></li><li class="alt"><span>            <span class="_this">this</span><span>.model = post;</span></span></li><li><span>            <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.render();</span></span></li><li class="alt"><span>          }, <span class="_this">this</span><span>));</span></span></li><li><span>        }</span></li><li class="alt"><span>      }</span></li><li><span>    }</span></li><li class="alt"><span>  }</span></li><li><span>});</span></li></ol></div></pre>

<h3>@extend helpers: template_helpers</h3>

<p>Adds helper methods to templates:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.extend helpers:</span></span></li><li><span>  url: (params) <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    <span class="_this">@url</span><span> params</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.extend({</span></span></li><li><span>  helpers: {</span></li><li class="alt"><span>   <span class="func_dec"> url</span><span>: </span><span class="keyword">function</span><span>(params) {</span></span></li><li><span>      <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.url(params);</span></span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@element</h3>

<p>The outer most DOM Element in the view which is available as soon as the view is created (before <strong>initialize</strong> or <strong>render</strong> are called). The Element is never removed even when the view is re-rendered.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>$(</span><span class="string">'body'</span><span>).append PostView</span></span></li><li><span>PostView.$.html() <span class="comment">#empty</span><span></span></span></li><li class="alt"><span>PostView.initialize <span class="func_dec">-&gt;</span><span></span></span></li><li><span>  @$.html() <span class="comment">#contents of post.eco</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>$(</span><span class="string">'body'</span><span>).append(PostView);</span></span></li><li><span>PostView.$.html();</span></li><li class="alt"><span>PostView.initialize(<span class="keyword">function</span><span>() {</span></span></li><li><span>  <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.$.html();</span></span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@extend element: -&gt; Element</h3>

<p>Override the default element which is a div with a className containing the <strong>name</strong> attribute of the view.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>{PostCollectionView} = View.create</span></span></li><li><span>  PostCollectionView: [Builder,</span></li><li class="alt"><span>    collection: PostCollection</span></li><li><span>    element: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>      <span class="_this">@ul</span><span>()</span></span></li><li><span>    render: (post) <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>      <span class="_this">@li</span><span> post.get </span><span class="string">'title'</span><span></span></span></li><li><span>  ]</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> PostCollectionView;</span></span></li><li><span>PostCollectionView = View.create({</span></li><li class="alt"><span>  PostCollectionView: [</span></li><li><span>    Builder, {</span></li><li class="alt"><span>      collection: PostCollection,</span></li><li><span>     <span class="func_dec"> element</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>        <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.ul();</span></span></li><li><span>      },</span></li><li class="alt"><span>     <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>(post) {</span></span></li><li><span>        <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.li(post.get(</span><span class="string">'title'</span><span>));</span></span></li><li class="alt"><span>      }</span></li><li><span>    }</span></li><li class="alt"><span>  ]</span></li><li><span>}).PostCollectionView;</span></li></ol></div></pre>

<h3>@extend delegate: events</h3>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.create PostView:</span></span></li><li><span>  delegate:</span></li><li class="alt"><span>    <span class="string">'click a.class'</span><span>: (</span><span class="builtin">event</span><span>) </span><span class="func_dec">-&gt;</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.create({</span></span></li><li><span>  PostView: {</span></li><li class="alt"><span>    delegate: {</span></li><li><span>      <span class="string">'click a.class'</span><span>: </span><span class="keyword">function</span><span>(</span><span class="builtin">event</span><span>) {}</span></span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@extend templates: template_name: -&gt;</h3>

<p><strong>ViewServer</strong> will automatically compile the contents of the <strong>templates</strong> directory and set this property accordingly, but if using <strong>View</strong> standalone this property should contain filename: callback pairs. The callbacks must return HTML strings and <strong>not</strong> DOM Elements. The <strong>templates</strong> attribute must be set on the base <strong>View</strong> object.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.extend</span></span></li><li><span>  templates:</span></li><li class="alt"><span>    <span class="string">'post.eco'</span><span>: (attributes) </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>      &quot;html output&quot;</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.extend({</span></span></li><li><span>  templates: {</span></li><li class="alt"><span>    <span class="string">'post.eco'</span><span>: </span><span class="keyword">function</span><span>(attributes) {</span></span></li><li><span>      <span class="keyword">return</span><span> </span><span class="string">"html output"</span><span>;</span></span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h2>Events</h2>

<p>The following events are triggered internally by View:</p>

<ul><li><strong>initialize: -&gt;</strong> Triggered when the view is initialized.</li><li><strong>change: -&gt;</strong> Triggered when any attribute in the view has changed.</li><li><strong>change:key: (value) -&gt;</strong> Triggered when a particular key changes.</li><li><strong>ready: -&gt;</strong> Triggered the first time a view is rendered.</li><li><strong>render: -&gt;</strong> Triggered when a view is rendered.</li><li><strong>activated: -&gt;</strong> Triggered when a route activates the view.</li><li><strong>deactivated: -&gt;</strong> Triggered when a view was active, and another view is activated by a route.</li><li><strong>error: (error) -&gt;</strong> Triggered when an exception is thrown.</li><li><strong>warning: (warning) -&gt;</strong> Triggered when a warning (such as a deprecation) occurs.</li></ul>

<h3>@bind event_name, callback</h3>

<h3>@on event_name, callback</h3>

<p>Bind a callback to an event. <strong>bind</strong> and <strong>on</strong> are aliases.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>PostView.bind </span><span class="string">'render'</span><span>, </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>  console.log <span class="string">'Post rendered'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>PostView.bind(</span><span class="string">'render'</span><span>, </span><span class="keyword">function</span><span>() {</span></span></li><li><span>  <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'Post rendered'</span><span>);</span></span></li><li class="alt"><span>});</span></li></ol></div></pre>

<p>An object containing event name, callback pairs can also be used:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>PostView.on</span></span></li><li><span>  render: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    console.log <span class="string">'Post rendered'</span><span></span></span></li><li><span>  initialize: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    console.log <span class="string">'Post initialized'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>PostView.on({</span></span></li><li><span> <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>    <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'Post rendered'</span><span>);</span></span></li><li><span>  },</span></li><li class="alt"><span> <span class="func_dec"> initialize</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>    <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'Post initialized'</span><span>);</span></span></li><li class="alt"><span>  }</span></li><li><span>});</span></li></ol></div></pre>

<h3>@extend on: events</h3>

<p>The same behavior can be achieved using a mixin:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>PostView.extend</span></span></li><li><span>  on:</span></li><li class="alt"><span>    render: <span class="func_dec">-&gt;</span><span></span></span></li><li><span>      console.log <span class="string">'Post rendered'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>PostView.extend({</span></span></li><li><span>  on: {</span></li><li class="alt"><span>   <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>      <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'Post rendered'</span><span>);</span></span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@unbind/removeListener event_name = false, handler = -&gt;</h3>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>PostView.unbind </span><span class="string">'render'</span><span>, handler </span><span class="comment">#unbinds a particular handler</span><span></span></span></li><li><span>PostView.unbind <span class="string">'render'</span><span> </span><span class="comment">#unbinds all render handlers</span><span></span></span></li><li class="alt"><span>PostView.unbind() <span class="comment">#unbinds all</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>PostView.unbind(</span><span class="string">'render'</span><span>, handler);</span></span></li><li><span>PostView.unbind(<span class="string">'render'</span><span>);</span></span></li><li class="alt"><span>PostView.unbind();</span></li></ol></div></pre>

<p><strong>Unbinding all is not recommended</strong> as there are many internal events.</p>

<h3>@trigger/emit event_name, args...</h3>

<p>Trigger a given event with an arbitrary number of arguments.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>PostView.bind </span><span class="string">'custom'</span><span>, (arg1,arg2) </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>PostView.trigger <span class="string">'custom'</span><span>, arg1, arg2</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>PostView.bind(</span><span class="string">'custom'</span><span>, </span><span class="keyword">function</span><span>(arg1, arg2) {});</span></span></li><li><span>PostView.trigger(<span class="string">'custom'</span><span>, arg1, arg2);</span></span></li></ol></div></pre>

<h3>@before: method_name: (original_method,args...) -&gt;</h3>

<p>A simple implementation of AOP. A logger could be implemented as:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.extend log: (method_name) </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>  <span class="_this">@before</span><span> method_name, (next,args...) </span><span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    response = next.apply @, args</span></li><li><span>    console.log &quot;<span class="comment">#{@name}.#{method_name}&quot;, args, ' -&gt; ', response</span><span></span></span></li><li class="alt"><span>    response</span></li><li><span></span></li><li class="alt"><span>View.log <span class="string">'set'</span><span></span></span></li><li><span>View.log <span class="string">'get'</span><span></span></span></li><li class="alt"><span></span></li><li><span>instance = View.create()</span></li><li class="alt"><span>instance.set key: <span class="string">'value'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> instance;</span></span></li><li><span><span class="keyword">var</span><span> __slice = </span><span class="builtin">Array</span><span class="support_property">.prototype</span><span>.slice;</span></span></li><li class="alt"><span>View.extend({</span></li><li><span> <span class="func_dec"> log</span><span>: </span><span class="keyword">function</span><span>(method_name) {</span></span></li><li class="alt"><span>    <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.before(method_name, </span><span class="keyword">function</span><span>() {</span></span></li><li><span>      <span class="keyword">var</span><span> args, next, response;</span></span></li><li class="alt"><span>      next = arguments[<span class="constants">0</span><span>], args = </span><span class="constants">2</span><span> </span></span></li></ol></div></pre>

<h2>Env</h2>

<p>Allows for the conditional execution of code depending on environment. The following environments are built in:</p>

<ul><li><strong>server</strong>:  Executed when the application is being processed by NodeJS</li><li><strong>browser</strong>: Executed by a remote client / web browser. <strong>Note that this will become &quot;client&quot; in a future release, but is not presently so due to internal usage. Usage of &quot;browser&quot; will continue to work but will issue a deprecation warning in the future.</strong></li></ul>

<h3>@env: name: -&gt;</h3>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.env</span></span></li><li><span>  server: <span class="func_dec">-&gt;</span><span> console.log </span><span class="string">'only run on the server'</span><span></span></span></li><li class="alt"><span>  browser: <span class="func_dec">-&gt;</span><span> console.log </span><span class="string">'only run on a browser'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.env({</span></span></li><li><span> <span class="func_dec"> server</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>    <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'only run on the server'</span><span>);</span></span></li><li><span>  },</span></li><li class="alt"><span> <span class="func_dec"> browser</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>    <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'only run on a browser'</span><span>);</span></span></li><li class="alt"><span>  }</span></li><li><span>});</span></li></ol></div></pre>

<h3>@env: set: name: -&gt;</h3>

<p>New environment names can be set using the <strong>set</strong> key:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.env set:</span></span></li><li><span>  ie: <span class="func_dec">-&gt;</span><span> !!</span><span class="builtin">window</span><span>.attachEvent and not </span><span class="builtin">window</span><span>.opera</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.env({</span></span></li><li><span>  set: {</span></li><li class="alt"><span>   <span class="func_dec"> ie</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>      <span class="keyword">return</span><span> !!</span><span class="builtin">window</span><span>.attachEvent && !</span><span class="builtin">window</span><span>.opera;</span></span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@extend env: name: -&gt;</h3>

<p>The <strong>env</strong> directive can be used in a mixin.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.extend</span></span></li><li><span>  env:</span></li><li class="alt"><span>    ie: <span class="func_dec">-&gt;</span><span></span></span></li><li><span>      <span class="_this">@on</span><span> render: </span><span class="func_dec">-&gt;</span><span> console.log </span><span class="string">'render called in IE'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.extend({</span></span></li><li><span>  env: {</span></li><li class="alt"><span>   <span class="func_dec"> ie</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>      <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.on({</span></span></li><li class="alt"><span>       <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>          <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'render called in IE'</span><span>);</span></span></li><li class="alt"><span>        }</span></li><li><span>      });</span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@extend env: name: mixin</h3>

<p>The <strong>env</strong> directive in a mixin, can itself contain a mixin that will be passed to extend.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.extend</span></span></li><li><span>  env:</span></li><li class="alt"><span>    ie:</span></li><li><span>      on:</span></li><li class="alt"><span>        render: <span class="func_dec">-&gt;</span><span> console.log </span><span class="string">'render called in IE'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.extend({</span></span></li><li><span>  env: {</span></li><li class="alt"><span>    ie: {</span></li><li><span>      on: {</span></li><li class="alt"><span>       <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>          <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'render called in IE'</span><span>);</span></span></li><li class="alt"><span>        }</span></li><li><span>      }</span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h2>Routes</h2>

<h3>routes: path: view_name</h3>

<p>This is automatically set by the <strong>ViewServer</strong>, but when using View standalone you must manually set this before you can use the <strong>Router</strong> mixin. Attributes matched in a route will be <strong>@set</strong> on the view when it is <strong>activated</strong>.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.extend</span></span></li><li><span>  routes:</span></li><li class="alt"><span>    <span class="string">'/about/'</span><span>: </span><span class="string">'AboutPageView'</span><span></span></span></li><li><span>    <span class="string">'/contact/'</span><span>: </span><span class="string">'ContactPageView'</span><span></span></span></li><li class="alt"><span>    <span class="string">'/blog/:post_id'</span><span>: </span><span class="string">'PostView'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.extend({</span></span></li><li><span>  routes: {</span></li><li class="alt"><span>    <span class="string">'/about/'</span><span>: </span><span class="string">'AboutPageView'</span><span>,</span></span></li><li><span>    <span class="string">'/contact/'</span><span>: </span><span class="string">'ContactPageView'</span><span>,</span></span></li><li class="alt"><span>    <span class="string">'/blog/:post_id'</span><span>: </span><span class="string">'PostView'</span><span></span></span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@url view_name: attributes</h3>

<p>Generates a URL for a given view and attributes. The view must have a corresponding route.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span class="string">'/post/5'</span><span> is View.url PostView: id: </span><span class="constants">5</span><span></span></span></li><li><span><span class="string">'/post/5'</span><span> is PostView.url id: </span><span class="constants">5</span><span></span></span></li><li class="alt"><span><span class="string">'/'</span><span> is View.url IndexView: {}</span></span></li><li><span><span class="string">'/'</span><span> is IndexView.url()</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="string">'/post/5'</span><span> === View.url({</span></span></li><li><span>  PostView: {</span></li><li class="alt"><span>    id: <span class="constants">5</span><span></span></span></li><li><span>  }</span></li><li class="alt"><span>});</span></li><li><span><span class="string">'/post/5'</span><span> === PostView.url({</span></span></li><li class="alt"><span>  id: <span class="constants">5</span><span></span></span></li><li><span>});</span></li><li class="alt"><span><span class="string">'/'</span><span> === View.url({</span></span></li><li><span>  IndexView: {}</span></li><li class="alt"><span>});</span></li><li><span><span class="string">'/'</span><span> === IndexView.url();</span></span></li></ol></div></pre>

<h2>Mixins</h2>

<h3>Router</h3>

<p>The Router uses the excellent <a href="History.js">https://github.com/balupton/History.js/</a> to manage the history state in the browser. <strong>The recommended behavior is to serve browsers incapable of supporting the HTML5 history API a static HTML snapshot of the view.</strong> The <strong>ViewServer</strong> provides the <strong>legacy</strong> and <strong>html5</strong> directives to <strong>@env</strong> to easily allow this.</p>

<p>When a view is activated by a route the <strong>deactivated</strong> event is triggered on the previous activated view, and the <strong>activated</strong> event is triggered on the newly active view. Client side the deactivated view is hidden and the activated view is shown. Server side, all views but the activated one will be removed from the DOM before it is serialized.</p>

<p>Each application that uses Routes must mixin the Router once. The Router mixin makes available <strong>@Router</strong> which will contain a div, which itself contains all of the elements of the routed views.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.extend</span></span></li><li><span>  routes:</span></li><li class="alt"><span>    <span class="string">'/about/'</span><span>: </span><span class="string">'AboutPageView'</span><span></span></span></li><li><span>    <span class="string">'/contact/'</span><span>: </span><span class="string">'ContactPageView'</span><span></span></span></li><li class="alt"><span>    <span class="string">'/blog/:post_id'</span><span>: </span><span class="string">'PostView'</span><span></span></span></li><li><span></span></li><li class="alt"><span>View.create</span></li><li><span>  ApplicationView: [Router,</span></li><li class="alt"><span>    render: <span class="func_dec">-&gt;</span><span></span></span></li><li><span>      <span class="_this">@div</span><span> </span><span class="_this">@Router</span><span></span></span></li><li class="alt"><span>  ]</span></li><li><span></span></li><li class="alt"><span>  AboutPageView:</span></li><li><span>    render: <span class="string">'about.eco'</span><span></span></span></li><li class="alt"><span></span></li><li><span>  ContactPageView:</span></li><li class="alt"><span>    render: <span class="string">'contact.eco'</span><span></span></span></li><li><span></span></li><li class="alt"><span>  PostView:</span></li><li><span>    render: <span class="string">'post.eco'</span><span></span></span></li><li class="alt"><span>    on:</span></li><li><span>      change:</span></li><li class="alt"><span>        post_id: (post_id) <span class="func_dec">-&gt;</span><span></span></span></li><li><span>          Post.find post_id, (post) <span class="func_dec">=&gt;</span><span></span></span></li><li class="alt"><span>            <span class="_this">@model</span><span> = post</span></span></li><li><span>            <span class="_this">@render</span><span>()</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> __bind = </span><span class="keyword">function</span><span>(fn, me){ </span><span class="keyword">return</span><span> </span><span class="keyword">function</span><span>(){ </span><span class="keyword">return</span><span> fn.</span><span class="support_method">apply</span><span>(me, arguments); }; };</span></span></li><li><span>View.extend({</span></li><li class="alt"><span>  routes: {</span></li><li><span>    <span class="string">'/about/'</span><span>: </span><span class="string">'AboutPageView'</span><span>,</span></span></li><li class="alt"><span>    <span class="string">'/contact/'</span><span>: </span><span class="string">'ContactPageView'</span><span>,</span></span></li><li><span>    <span class="string">'/blog/:post_id'</span><span>: </span><span class="string">'PostView'</span><span></span></span></li><li class="alt"><span>  }</span></li><li><span>});</span></li><li class="alt"><span>View.create({</span></li><li><span>  ApplicationView: [</span></li><li class="alt"><span>    Router, {</span></li><li><span>     <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>        <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.div(</span><span class="_this">this</span><span>.Router);</span></span></li><li><span>      }</span></li><li class="alt"><span>    }</span></li><li><span>  ],</span></li><li class="alt"><span>  AboutPageView: {</span></li><li><span>    render: <span class="string">'about.eco'</span><span></span></span></li><li class="alt"><span>  },</span></li><li><span>  ContactPageView: {</span></li><li class="alt"><span>    render: <span class="string">'contact.eco'</span><span></span></span></li><li><span>  },</span></li><li class="alt"><span>  PostView: {</span></li><li><span>    render: <span class="string">'post.eco'</span><span>,</span></span></li><li class="alt"><span>    on: {</span></li><li><span>      change: {</span></li><li class="alt"><span>       <span class="func_dec"> post_id</span><span>: </span><span class="keyword">function</span><span>(post_id) {</span></span></li><li><span>          <span class="keyword">return</span><span> Post.</span><span class="support_method">find</span><span>(post_id, __bind(</span><span class="keyword">function</span><span>(post) {</span></span></li><li class="alt"><span>            <span class="_this">this</span><span>.model = post;</span></span></li><li><span>            <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.render();</span></span></li><li class="alt"><span>          }, <span class="_this">this</span><span>));</span></span></li><li><span>        }</span></li><li class="alt"><span>      }</span></li><li><span>    }</span></li><li class="alt"><span>  }</span></li><li><span>});</span></li></ol></div></pre>

<h3>Builder</h3>

<p>The builder mixin adds all valid HTML5 tag names as methods to a view. Usage of Builder is covered in the <strong>tag</strong> method.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>{TableView} = View.create TableView: [Builder,</span></span></li><li><span>  render: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    <span class="_this">@table</span><span> cellpadding: </span><span class="constants">0</span><span>, cellspacing: </span><span class="constants">0</span><span>,</span></span></li><li><span>      <span class="_this">@tbody</span><span>(</span></span></li><li class="alt"><span>        <span class="_this">@tr</span><span>(</span></span></li><li><span>          <span class="_this">@td</span><span> </span><span class="string">'Cell One'</span><span></span></span></li><li class="alt"><span>          <span class="_this">@td</span><span> </span><span class="string">'Cell Two'</span><span></span></span></li><li><span>        )</span></li><li class="alt"><span>      )</span></li><li><span>]</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> TableView;</span></span></li><li><span>TableView = View.create({</span></li><li class="alt"><span>  TableView: [</span></li><li><span>    Builder, {</span></li><li class="alt"><span>     <span class="func_dec"> render</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>        <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.table({</span></span></li><li class="alt"><span>          cellpadding: <span class="constants">0</span><span>,</span></span></li><li><span>          cellspacing: <span class="constants">0</span><span></span></span></li><li class="alt"><span>        }, <span class="_this">this</span><span>.tbody(</span><span class="_this">this</span><span>.tr(</span><span class="_this">this</span><span>.td(</span><span class="string">'Cell One'</span><span>), </span><span class="_this">this</span><span>.td(</span><span class="string">'Cell Two'</span><span>))));</span></span></li><li><span>      }</span></li><li class="alt"><span>    }</span></li><li><span>  ]</span></li><li class="alt"><span>}).TableView;</span></li></ol></div></pre>

<h1>ViewServer</h1>

<h2>ViewServer</h2>

<h3>ViewServer view_name</h3>

<p>Find a ViewServer by name:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>BlogServer = View </span><span class="string">'BlogServer'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> BlogServer;</span></span></li><li><span>BlogServer = View(<span class="string">'BlogServer'</span><span>);</span></span></li></ol></div></pre>

<h3>ViewServer server_name: -&gt;</h3>

<p>Passing in name: callback pairs will call the callback with the ViewServer as it's context when the ViewServer is available:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>ViewServer BlogServer: </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>  <span class="_this">@server</span><span>.use express.logger() </span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>ViewServer({</span></span></li><li><span> <span class="func_dec"> BlogServer</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>    <span class="keyword">return</span><span> </span><span class="_this">this</span><span>.server.use(express.logger());</span></span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@create server_name: mixins</h3>

<p>The ViewServer's mixin system and create method works identically to View's.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>ViewServer.create BlogServer: </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>  port: <span class="constants">3001</span><span></span></span></li><li class="alt"><span>  <span class="keyword">public</span><span>: __dirname + </span><span class="string">'/public'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>ViewServer.create({</span></span></li><li><span> <span class="func_dec"> BlogServer</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>    <span class="keyword">return</span><span> {</span></span></li><li><span>      port: <span class="constants">3001</span><span>,</span></span></li><li class="alt"><span>      <span class="keyword">public</span><span>: __dirname + </span><span class="string">'/public'</span><span></span></span></li><li><span>    };</span></li><li class="alt"><span>  }</span></li><li><span>});</span></li></ol></div></pre>

<h2>Server</h2>

<h3>@server</h3>

<p>The Express instance which handles requests for the ViewServer.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>express = require </span><span class="string">'express'</span><span></span></span></li><li><span>BlogServer.server.use express.logger()</span></li><li class="alt"><span>BlogServer.server.get <span class="string">'/custom/'</span><span>, (request,response) </span><span class="func_dec">-&gt;</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> express;</span></span></li><li><span>express = require(<span class="string">'express'</span><span>);</span></span></li><li class="alt"><span>BlogServer.server.use(express.logger());</span></li><li><span>BlogServer.server.get(<span class="string">'/custom/'</span><span>, </span><span class="keyword">function</span><span>(request, response) {});</span></span></li></ol></div></pre>

<h3>@extend server: express_instance</h3>

<p>If no <strong>server</strong> attribute is supplied, an Express server will automatically be created. Or you can supply a custom one:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>express = require </span><span class="string">'express'</span><span></span></span></li><li><span>server = express.createServer()</span></li><li class="alt"><span>{BlogServer} = ViewServer.create</span></li><li><span>  server: server</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> BlogServer, express, server;</span></span></li><li><span>express = require(<span class="string">'express'</span><span>);</span></span></li><li class="alt"><span>server = express.createServer();</span></li><li><span>BlogServer = ViewServer.create({</span></li><li class="alt"><span>  server: server</span></li><li><span>}).BlogServer;</span></li></ol></div></pre>

<h3>@extend port: number</h3>

<p>The port number to listen on. When both <strong>port</strong> and <strong>public</strong> have been defined in the server <strong>@server.listen()</strong> will be called.</p>

<h3>@extend public: path</h3>

<p>Full path to the public directory. When both <strong>port</strong> and <strong>public</strong> have been defined in the server <strong>@server.listen()</strong> will be called.</p>

<h3>@extend templates: path</h3>

<p>Full path to the templates directory. All eco and Jade templates in this directory will automatically be compiled to <strong>public/javascripts/templates.js</strong> when running the <strong>cake watch</strong> command.</p>

<h2>Assets</h2>

<h3>@extend javascripts: [javascripts...]</h3>

<p>JavaScript tags to send to the browser on each request. If a directory is specified it will be recursively searched for <strong>.js</strong> files.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span class="keyword">public</span><span> = &quot;</span><span class="comment">#{__dirname}/public/javascripts/lib/&quot;</span><span></span></span></li><li><span>BlogServer.extend javascripts: [</span></li><li class="alt"><span>  &quot;<span class="comment">#{public}/javascripts/lib/view.js&quot;</span><span></span></span></li><li><span>  &quot;<span class="comment">#{public}/javascripts/models/&quot;</span><span></span></span></li><li class="alt"><span>  &quot;<span class="comment">#{public}/javascripts/views/&quot;</span><span></span></span></li><li><span>]</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> </span><span class="keyword">public</span><span>;</span></span></li><li><span><span class="keyword">public</span><span> = </span><span class="string">""</span><span> + __dirname + </span><span class="string">"/public/javascripts/lib/"</span><span>;</span></span></li><li class="alt"><span>BlogServer.extend({</span></li><li><span>  javascripts: [<span class="string">""</span><span> + </span><span class="keyword">public</span><span> + </span><span class="string">"/javascripts/lib/view.js"</span><span>, </span><span class="string">""</span><span> + </span><span class="keyword">public</span><span> + </span><span class="string">"/javascripts/models/"</span><span>, </span><span class="string">""</span><span> + </span><span class="keyword">public</span><span> + </span><span class="string">"/javascripts/views/"</span><span>]</span></span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@extend execute: [execute...]</h3>

<p>JavaScript to execute server side on each request. If a directory is specified it will be recursively searched for <strong>.js</strong> files.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span class="keyword">public</span><span> = &quot;</span><span class="comment">#{__dirname}/public/javascripts/lib/&quot;</span><span></span></span></li><li><span>BlogServer.extend execute: [</span></li><li class="alt"><span>  &quot;<span class="comment">#{public}/javascripts/lib/view.js&quot;</span><span></span></span></li><li><span>  &quot;<span class="comment">#{public}/javascripts/models/&quot;</span><span></span></span></li><li class="alt"><span>  &quot;<span class="comment">#{public}/javascripts/views/&quot;</span><span></span></span></li><li><span>]</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> </span><span class="keyword">public</span><span>;</span></span></li><li><span><span class="keyword">public</span><span> = </span><span class="string">""</span><span> + __dirname + </span><span class="string">"/public/javascripts/lib/"</span><span>;</span></span></li><li class="alt"><span>BlogServer.extend({</span></li><li><span>  execute: [<span class="string">""</span><span> + </span><span class="keyword">public</span><span> + </span><span class="string">"/javascripts/lib/view.js"</span><span>, </span><span class="string">""</span><span> + </span><span class="keyword">public</span><span> + </span><span class="string">"/javascripts/models/"</span><span>, </span><span class="string">""</span><span> + </span><span class="keyword">public</span><span> + </span><span class="string">"/javascripts/views/"</span><span>]</span></span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@extend stylesheets: [stylesheets...]</h3>

<p>Add stylesheets to. If a directory is specified it will be recursively searched for <strong>.css</strong> files.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span class="keyword">public</span><span> = &quot;</span><span class="comment">#{__dirname}/public/&quot;</span><span></span></span></li><li><span>BlogServer.extend stylesheets: [</span></li><li class="alt"><span>  &quot;<span class="comment">#{public}/stylesheets/a.css&quot;</span><span></span></span></li><li><span>  &quot;<span class="comment">#{public}/stylesheets/b.css&quot;</span><span></span></span></li><li class="alt"><span>  <span class="comment">#now scan the directory for all remaining stylesheets</span><span></span></span></li><li><span>  &quot;<span class="comment">#{public}/stylesheets/&quot;</span><span></span></span></li><li class="alt"><span>]</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> </span><span class="keyword">public</span><span>;</span></span></li><li><span><span class="keyword">public</span><span> = </span><span class="string">""</span><span> + __dirname + </span><span class="string">"/public/"</span><span>;</span></span></li><li class="alt"><span>BlogServer.extend({</span></li><li><span>  stylesheets: [<span class="string">""</span><span> + </span><span class="keyword">public</span><span> + </span><span class="string">"/stylesheets/a.css"</span><span>, </span><span class="string">""</span><span> + </span><span class="keyword">public</span><span> + </span><span class="string">"/stylesheets/b.css"</span><span>, </span><span class="string">""</span><span> + </span><span class="keyword">public</span><span> + </span><span class="string">"/stylesheets/"</span><span>]</span></span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@extend meta: [meta...]</h3>

<p>Inject arbitrary meta information into the document head.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>BlogServer.extend meta: [</span></span></li><li><span>  <span class="string">'&lt;link rel=&quot;alternate&quot; type=&quot;application/rss+xml&quot; title=&quot;Feed Name&quot; href=&quot;url&quot; /&gt;'</span><span></span></span></li><li class="alt"><span>]</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>BlogServer.extend({</span></span></li><li><span>  meta: [<span class="string">'<link rel="alternate" type="application/rss+xml" title="Feed Name" href="url">'</span><span>]</span></span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h2>Env</h2>

<p>Execute code, or process mixin directives conditionally per request. The following environments are pre-defined:</p>

<ul><li><strong>html5</strong>: If the user-agent supports the HTML5 history API.</li><li><strong>legacy</strong>: If the user-agent does not support the HTML5 history API.</li></ul>

<h3>@env: request, name: -&gt;</h3>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>View.env request,</span></span></li><li><span>  html5: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    console.log <span class="string">'only run when an HTML5 capable user agent initiated the request'</span><span></span></span></li><li><span>  legacy: (request) <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    console.log <span class="string">'only run when a non HTML5 capable user agent initiated the request'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>View.env(request, {</span></span></li><li><span> <span class="func_dec"> html5</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li class="alt"><span>    <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'only run when an HTML5 capable user agent initiated the request'</span><span>);</span></span></li><li><span>  },</span></li><li class="alt"><span> <span class="func_dec"> legacy</span><span>: </span><span class="keyword">function</span><span>(request) {</span></span></li><li><span>    <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'only run when a non HTML5 capable user agent initiated the request'</span><span>);</span></span></li><li class="alt"><span>  }</span></li><li><span>});</span></li></ol></div></pre>

<h3>@extend: env: name: mixin</h3>

<p>The following mixin directives can be used in an <strong>env</strong> directive:</p>

<ul><li><strong>execute</strong></li><li><strong>javascripts</strong></li><li><strong>stylesheets</strong></li><li><strong>meta</strong></li></ul>

<p>In the following example the Typekit JavaScript would be available in a script tag in the header for both legacy and HTML5 capable browsers, but the rest of the application would be run server side for legacy browsers, and client side for HTML5 browsers.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span class="keyword">public</span><span> = __dirname + </span><span class="string">'/public/'</span><span></span></span></li><li><span>application_payload = [</span></li><li class="alt"><span>  &quot;<span class="comment">#{public}javascripts/lib/jquery.js&quot;</span><span></span></span></li><li><span>  &quot;<span class="comment">#{public}javascripts/lib/underscore.js&quot;</span><span></span></span></li><li class="alt"><span>  &quot;<span class="comment">#{public}javascripts/lib/backbone.js&quot;</span><span></span></span></li><li><span>  &quot;<span class="comment">#{public}javascripts/lib/view.js&quot;</span><span></span></span></li><li class="alt"><span>  &quot;<span class="comment">#{public}javascripts/templates.js&quot;</span><span></span></span></li><li><span>  &quot;<span class="comment">#{public}javascripts/models&quot;</span><span></span></span></li><li class="alt"><span>  &quot;<span class="comment">#{public}javascripts/views&quot;</span><span></span></span></li><li><span>]</span></li><li class="alt"><span></span></li><li><span>{MyServer} = ViewServer.create MyServer:</span></li><li class="alt"><span>  <span class="keyword">public</span><span>: </span><span class="keyword">public</span><span></span></span></li><li><span>  javascripts: [</span></li><li class="alt"><span>    &quot;http:<span class="comment">//use.typekit.com/xxx.js&quot;</span><span></span></span></li><li><span>  ]</span></li><li class="alt"><span>  env:</span></li><li><span>    legacy:</span></li><li class="alt"><span>      execute: application_payload</span></li><li><span>    html5:</span></li><li class="alt"><span>      javascripts: application_payload</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span class="keyword">var</span><span> MyServer, application_payload, </span><span class="keyword">public</span><span>;</span></span></li><li><span><span class="keyword">public</span><span> = __dirname + </span><span class="string">'/public/'</span><span>;</span></span></li><li class="alt"><span>application_payload = [<span class="string">""</span><span> + </span><span class="keyword">public</span><span> + </span><span class="string">"javascripts/lib/jquery.js"</span><span>, </span><span class="string">""</span><span> + </span><span class="keyword">public</span><span> + </span><span class="string">"javascripts/lib/underscore.js"</span><span>, </span><span class="string">""</span><span> + </span><span class="keyword">public</span><span> + </span><span class="string">"javascripts/lib/backbone.js"</span><span>, </span><span class="string">""</span><span> + </span><span class="keyword">public</span><span> + </span><span class="string">"javascripts/lib/view.js"</span><span>, </span><span class="string">""</span><span> + </span><span class="keyword">public</span><span> + </span><span class="string">"javascripts/templates.js"</span><span>, </span><span class="string">""</span><span> + </span><span class="keyword">public</span><span> + </span><span class="string">"javascripts/models"</span><span>, </span><span class="string">""</span><span> + </span><span class="keyword">public</span><span> + </span><span class="string">"javascripts/views"</span><span>];</span></span></li><li><span>MyServer = ViewServer.create({</span></li><li class="alt"><span>  MyServer: {</span></li><li><span>    <span class="keyword">public</span><span>: </span><span class="keyword">public</span><span>,</span></span></li><li class="alt"><span>    javascripts: [<span class="string">"http://use.typekit.com/xxx.js"</span><span>],</span></span></li><li><span>    env: {</span></li><li class="alt"><span>      legacy: {</span></li><li><span>        execute: application_payload</span></li><li class="alt"><span>      },</span></li><li><span>      html5: {</span></li><li class="alt"><span>        javascripts: application_payload</span></li><li><span>      }</span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>}).MyServer;</span></li></ol></div></pre>

<h3>@env: set: name: (request) -&gt;</h3>

<p>Define a new environment. Request may not be present, so always check for <strong>request?</strong> first.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>ViewServer.env set:</span></span></li><li><span>  ios: (request) <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    request? and request.headers[<span class="string">'user-agent'</span><span>].match /(iPhone|iPad)/</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>ViewServer.env({</span></span></li><li><span>  set: {</span></li><li class="alt"><span>   <span class="func_dec"> ios</span><span>: </span><span class="keyword">function</span><span>(request) {</span></span></li><li><span>      <span class="keyword">return</span><span> (request != </span><span class="constants">null</span><span>) && request.headers[</span><span class="string">'user-agent'</span><span>].</span><span class="support_method">match</span><span>(/(iPhone|iPad)/);</span></span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<p>Not all environments depend on the request object. The following example sets <strong>development</strong> and <strong>production</strong> environments based on wether or not the code is run in the <a href="http://www.cloudfoundry.com/">VMWare Cloud Foundry</a> offering:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>ViewServer.env set:</span></span></li><li><span>  production: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    process?.env?.VCAP_APPLICATION</span></li><li><span>  development: <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    not process?.env?.VCAP_APPLICATION</span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>ViewServer.env({</span></span></li><li><span>  set: {</span></li><li class="alt"><span>   <span class="func_dec"> production</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>      <span class="keyword">var</span><span> _ref;</span></span></li><li class="alt"><span>      <span class="keyword">return</span><span> </span><span class="keyword">typeof</span><span> process != </span><span class="string">"undefined"</span><span> && process !== </span><span class="constants">null</span><span> ? (_ref = process.env) != </span><span class="constants">null</span><span> ? _ref.VCAP_APPLICATION : </span><span class="keyword">void</span><span> </span><span class="constants">0</span><span> : </span><span class="keyword">void</span><span> </span><span class="constants">0</span><span>;</span></span></li><li><span>    },</span></li><li class="alt"><span>   <span class="func_dec"> development</span><span>: </span><span class="keyword">function</span><span>() {</span></span></li><li><span>      <span class="keyword">var</span><span> _ref;</span></span></li><li class="alt"><span>      <span class="keyword">return</span><span> !(</span><span class="keyword">typeof</span><span> process != </span><span class="string">"undefined"</span><span> && process !== </span><span class="constants">null</span><span> ? (_ref = process.env) != </span><span class="constants">null</span><span> ? _ref.VCAP_APPLICATION : </span><span class="keyword">void</span><span> </span><span class="constants">0</span><span> : </span><span class="keyword">void</span><span> </span><span class="constants">0</span><span>);</span></span></li><li><span>    }</span></li><li class="alt"><span>  }</span></li><li><span>});</span></li></ol></div></pre>

<h2>Events</h2>

<p>The following events are triggered internally by ViewServer:</p>

<ul><li><strong>error: (error) -&gt;</strong> Triggered when an exception is thrown.</li><li><strong>warning: (warning) -&gt;</strong> Triggered when a warning (such as a deprecation) occurs.</li><li><strong>request: (request,response) -&gt;</strong> Triggered when an incoming request will be handled by a view.</li></ul>

<h3>@bind event_name, callback</h3>

<h3>@on event_name, callback</h3>

<p>Bind a callback to an event. <strong>bind</strong> and <strong>on</strong> are aliases.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>BlogServer.bind </span><span class="string">'request'</span><span>, (request,response) </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>  console.log <span class="string">'Incoming request'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>BlogServer.bind(</span><span class="string">'request'</span><span>, </span><span class="keyword">function</span><span>(request, response) {</span></span></li><li><span>  <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'Incoming request'</span><span>);</span></span></li><li class="alt"><span>});</span></li></ol></div></pre>

<p>An object containing event name, callback pairs can also be used:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>BlogServer.on</span></span></li><li><span>  request: (request,response) <span class="func_dec">-&gt;</span><span></span></span></li><li class="alt"><span>    console.log <span class="string">'Incoming request'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>BlogServer.on({</span></span></li><li><span> <span class="func_dec"> request</span><span>: </span><span class="keyword">function</span><span>(request, response) {</span></span></li><li class="alt"><span>    <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'Incoming request'</span><span>);</span></span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@extend on: events</h3>

<p>The same behavior can be achieved using a mixin:</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>BlogServer.extend</span></span></li><li><span>  on:</span></li><li class="alt"><span>    request: (request,response) <span class="func_dec">-&gt;</span><span></span></span></li><li><span>      console.log <span class="string">'Incoming request'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>BlogServer.extend({</span></span></li><li><span>  on: {</span></li><li class="alt"><span>   <span class="func_dec"> request</span><span>: </span><span class="keyword">function</span><span>(request, response) {</span></span></li><li><span>      <span class="keyword">return</span><span> console.</span><span class="support_method">log</span><span>(</span><span class="string">'Incoming request'</span><span>);</span></span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h3>@unbind/removeListener event_name = false, handler = -&gt;</h3>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>BlogServer.unbind </span><span class="string">'error'</span><span>, handler </span><span class="comment">#unbinds a particular handler</span><span></span></span></li><li><span>BlogServer.unbind <span class="string">'error'</span><span> </span><span class="comment">#unbinds all error handlers</span><span></span></span></li><li class="alt"><span>BlogServer.unbind() <span class="comment">#unbinds all</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>BlogServer.unbind(</span><span class="string">'error'</span><span>, handler);</span></span></li><li><span>BlogServer.unbind(<span class="string">'error'</span><span>);</span></span></li><li class="alt"><span>BlogServer.unbind();</span></li></ol></div></pre>

<h3>@trigger/emit event_name, args...</h3>

<p>Trigger a given event with an arbitrary number of arguments.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>BlogServer.bind </span><span class="string">'custom'</span><span>, (arg1,arg2) </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>BlogServer.trigger <span class="string">'custom'</span><span>, arg1, arg2</span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>BlogServer.bind(</span><span class="string">'custom'</span><span>, </span><span class="keyword">function</span><span>(arg1, arg2) {});</span></span></li><li><span>BlogServer.trigger(<span class="string">'custom'</span><span>, arg1, arg2);</span></span></li></ol></div></pre>

<h2>Routes</h2>

<h3>@extend routes: path: view_name</h3>

<p>Will register <strong>get</strong> handlers in express that will serve or execute JavaScript depending on the contents of the <strong>execute</strong> and <strong>javascripts</strong> directives, and will pass through route definitions to <strong>View.routes</strong> automatically.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>BlogServer.extend</span></span></li><li><span>  routes:</span></li><li class="alt"><span>    <span class="string">'/'</span><span>: </span><span class="string">'IndexView'</span><span></span></span></li><li><span>    <span class="string">'/post/:id'</span><span>: </span><span class="string">'PostView'</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>BlogServer.extend({</span></span></li><li><span>  routes: {</span></li><li class="alt"><span>    <span class="string">'/'</span><span>: </span><span class="string">'IndexView'</span><span>,</span></span></li><li><span>    <span class="string">'/post/:id'</span><span>: </span><span class="string">'PostView'</span><span></span></span></li><li class="alt"><span>  }</span></li><li><span>});</span></li></ol></div></pre>

<p>You can optionally pass a callback for low level control just like in Express. Specifying a port number will proxy all requests below that path to the given port number, specifying a fully qualified URL will proxy all requests below that path to the given URL.</p>

<pre class="highlighted"><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="coffeescript"><li class="alt"><span><span>BlogServer.extend</span></span></li><li><span>  routes:</span></li><li class="alt"><span>    <span class="string">'/local_api/'</span><span>: </span><span class="constants">3002</span><span></span></span></li><li><span>    <span class="string">'/remote_api/'</span><span>: &quot;http:</span><span class="comment">//api.service.com/&quot;</span><span></span></span></li><li class="alt"><span>    <span class="string">'/page/:name'</span><span>: (request,response) </span><span class="func_dec">-&gt;</span><span></span></span></li><li><span>      response.send <span class="string">'Page Contents'</span><span></span></span></li><li class="alt"><span></span></li><li><span><span class="comment"># reqests to:</span><span></span></span></li><li class="alt"><span><span class="comment"># /local_api/posts/2.json would proxy the request to: localhost:3002/posts/2.json</span><span></span></span></li><li><span><span class="comment"># /remote_api/posts/2.json would proxy the request to: http://api.service.com/posts/2.json</span><span></span></span></li></ol></div><div class="dp-highlighter nogutter"><div class="bar"></div><ol start="true" class="javascript"><li class="alt"><span><span>BlogServer.extend({</span></span></li><li><span>  routes: {</span></li><li class="alt"><span>    <span class="string">'/local_api/'</span><span>: </span><span class="constants">3002</span><span>,</span></span></li><li><span>    <span class="string">'/remote_api/'</span><span>: </span><span class="string">"http://api.service.com/"</span><span>,</span></span></li><li class="alt"><span>    <span class="string">'/page/:name'</span><span>: </span><span class="keyword">function</span><span>(request, response) {</span></span></li><li><span>      <span class="keyword">return</span><span> response.</span><span class="support_method">send</span><span>(</span><span class="string">'Page Contents'</span><span>);</span></span></li><li class="alt"><span>    }</span></li><li><span>  }</span></li><li class="alt"><span>});</span></li></ol></div></pre>

<h2>Cache</h2>

<h3>cache: [views...]</h3>

<p>TODO</p>
      </div>
    </div>
    <script type="text/javascript">
      var _gaq = _gaq || [];
      _gaq.push(['_setAccount', 'UA-20694546-1']);
      _gaq.push(['_trackPageview']);

      (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
      })();
    </script>
  </body>
</html>