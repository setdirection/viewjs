(function(e){function E(f,g,j,h){h={data:h||(g?g.data:{}),_wrap:g?g._wrap:null,tmpl:null,parent:g||null,nodes:[],calls:K,nest:L,wrap:M,html:Q,update:N};f&&e.extend(h,f,{nodes:[],parent:g});if(j){h.tmpl=j;h._ctnt=h._ctnt||h.tmpl(e,h);h.key=++o;(t.length?A:r)[o]=h}return h}function q(f,g,j){var h;j=j?e.map(j,function(k){return typeof k==="string"?f.key?k.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+y+'="'+f.key+'" $2'):k:q(k,f,k._ctnt)}):f;if(g)return j;j=j.join("");j.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(k,l,m,p){h=e(m).get();G(h);if(l)h=H(l).concat(h);if(p)h=h.concat(H(p))});return h?h:H(j)}function H(f){var g=document.createElement("div");g.innerHTML=f;return e.makeArray(g.childNodes)}function O(f){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+e.trim(f).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(g,j,h,k,l,m,p){g=e.tmpl.tag[h];if(!g)throw"Template command not found: "+h;h=g._default||[];if(m&&!/\w$/.test(l)){l+=m;m=""}if(l){l=B(l);p=p?","+B(p)+")":m?")":"";p=m?l.indexOf(".")>-1?l+B(m):"("+l+").call($item"+p:l;m=m?p:"(typeof("+l+")==='function'?("+l+").call($item):("+l+"))"}else m=p=h.$1||"null";k=B(k);return"');"+g[j?"close":"open"].split("$notnull_1").join(l?"typeof("+l+")!=='undefined' && ("+l+")!=null":"true").split("$1a").join(m).split("$1").join(p).split("$2").join(k||h.$2||
"")+"_.push('"})+"');}return _;")}function P(f,g){f._wrap=q(f,true,e.isArray(g)?g:[C.test(g)?g:e(g).html()]).join("")}function B(f){return f?f.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function G(f){function g(s){function a(n){n+=j;c=l[n]=l[n]||E(c,r[c.parent.key+j]||c.parent)}var b,d=s,c,i;if(i=s.getAttribute(y)){for(;d.parentNode&&(d=d.parentNode).nodeType===1&&!(b=d.getAttribute(y)););if(b!==i){d=d.parentNode?d.nodeType===11?0:d.getAttribute(y)||0:0;if(!(c=r[i])){c=A[i];c=E(c,r[d]||A[d]);
c.key=++o;r[o]=c}v&&a(i)}s.removeAttribute(y)}else if(v&&(c=e.data(s,"tmplItem"))){a(c.key);r[c.key]=c;d=(d=e.data(s.parentNode,"tmplItem"))?d.key:0}if(c){for(b=c;b&&b.key!=d;){b.nodes.push(s);b=b.parent}delete c._ctnt;delete c._wrap;e.data(s,"tmplItem",c)}}var j="_"+v,h,k,l={},m,p,z;m=0;for(p=f.length;m<p;m++)if((h=f[m]).nodeType===1){k=h.getElementsByTagName("*");for(z=k.length-1;z>=0;z--)g(k[z]);g(h)}}function K(f,g,j,h){if(!f)return t.pop();t.push({_:f,tmpl:g,item:this,data:j,options:h})}function L(f,
g,j){return e.tmpl(e.template(f),g,j,this)}function M(f,g){var j=f.options||{};j.wrapped=g;return e.tmpl(e.template(f.tmpl),f.data,j,f.item)}function Q(f,g){var j=this._wrap;return e.map(e(e.isArray(j)?j.join(""):j).filter(f||"*"),function(h){if(g)h=h.innerText||h.textContent;else{var k;if(!(k=h.outerHTML)){k=document.createElement("div");k.appendChild(h.cloneNode(true));k=k.innerHTML}h=k}return h})}function N(){var f=this.nodes;e.tmpl(null,null,null,this).insertBefore(f[0]);e(f).remove()}var w=e.fn.domManip,
y="_tmplitem",C=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,r={},A={},u,I={key:0,data:{}},o=0,v=0,t=[];e.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(f,g){e.fn[f]=function(j){var h=[];j=e(j);var k,l,m;k=this.length===1&&this[0].parentNode;u=r||{};if(k&&k.nodeType===11&&k.childNodes.length===1&&j.length===1){j[g](this[0]);h=this}else{l=0;for(m=j.length;l<m;l++){v=l;k=(l>0?this.clone(true):this).get();e(j[l])[g](k);h=h.concat(k)}v=0;
h=this.pushStack(h,f,j.selector)}j=u;u=null;e.tmpl.complete(j);return h}});e.fn.extend({tmpl:function(f,g,j){return e.tmpl(this[0],f,g,j)},tmplItem:function(){return e.tmplItem(this[0])},template:function(f){return e.template(f,this[0])},domManip:function(f,g,j){if(f[0]&&e.isArray(f[0])){for(var h=e.makeArray(arguments),k=f[0],l=k.length,m=0,p;m<l&&!(p=e.data(k[m++],"tmplItem")););if(p&&v)h[2]=function(z){e.tmpl.afterManip(this,z,j)};w.apply(this,h)}else w.apply(this,arguments);v=0;u||e.tmpl.complete(r);
return this}});e.extend({tmpl:function(f,g,j,h){var k=!h;if(k){h=I;f=e.template[f]||e.template(null,f);A={}}else if(!f){f=h.tmpl;r[h.key]=h;h.nodes=[];h.wrapped&&P(h,h.wrapped);return e(q(h,null,h.tmpl(e,h)))}if(!f)return[];if(typeof g==="function")g=g.call(h||{});j&&j.wrapped&&P(j,j.wrapped);g=e.isArray(g)?e.map(g,function(l){return l?E(j,h,f,l):null}):[E(j,h,f,g)];return k?e(q(h,null,g)):g},tmplItem:function(f){var g;if(f instanceof e)f=f[0];for(;f&&f.nodeType===1&&!(g=e.data(f,"tmplItem"))&&(f=
f.parentNode););return g||I},template:function(f,g){if(g){if(typeof g==="string")g=O(g);else if(g instanceof e)g=g[0]||{};if(g.nodeType)g=e.data(g,"tmpl")||e.data(g,"tmpl",O(g.innerHTML));return typeof f==="string"?e.template[f]=g:g}return f?typeof f!=="string"?e.template(null,f):e.template[f]||e.template(null,C.test(f)?f:e(f)):null},encode:function(f){return(""+f).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});e.extend(e.tmpl,{tag:{tmpl:{_default:{$2:"null"},
open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},
"!":{open:""}},complete:function(){r={}},afterManip:function(f,g,j){var h=g.nodeType===11?e.makeArray(g.childNodes):g.nodeType===1?[g]:[];j.call(f,g);G(h);v++}})})(jQuery);
(function(e,E,q){function H(a){return w(function(b){return e(b,a._element)},e(a._element))}function O(a,b){for(var d=["bind","unbind","one"],c=0;c<d.length;++c)(function(i){b[i]=f(b[i],function(n){var J=o(arguments).slice(1);a[i].apply(a,J);return n.apply(n,J)})})(d[c])}function P(a,b){var d=o(arguments).slice(1);d=a.apply(a,d);b=="ready"&&B(this);return d}function B(a){if(!a._readyEventFired&&a._element&&g(a._element)){a.trigger("ready");a._readyEventFired=true;a._readyEventInterval&&clearInterval(a._readyEventInterval)}else"_readyEventInterval"in
a||setTimeout(function(){if(a._element&&g(a._element)){a.trigger("ready");a._readyEventFired=true}else if(!a._readyEventInterval)a._readyEventInterval=setInterval(function(){try{if(a._element&&g(a._element)){a.trigger("ready");a._readyEventFired=true;clearInterval(a._readyEventInterval);a._readyEventInterval=false}}catch(b){clearInterval(a._readyEventInterval);throw b;}},10)})}function G(a,b,d,c){if(!(c===q||c===null||c===false)){if(typeof c==="function"&&!y(c))c=c();if(c&&c.element&&c.element().nodeType==
1&&c._attributes||typeof c.element=="function")b.push(c.element());else if(y(c))b.push((new c).element());else{if(typeof c==="function")c=c();if(typeof c!=="string"&&typeof c!=="number"&&!u(c)&&!C(c)&&!(c&&(c.nodeType===1||c.nodeType===3)))for(attribute_name in c)d[attribute_name]=c[attribute_name];else{if(A(a,c))c=a.render(c);if(C(c))c=c.toArray();if(u(c)){var i=M(c);for(c=0;c<i.length;++c)G(a,b,d,i[c])}else if(r(c)){a=L(c);for(c=0;c<a.length;++c)b.push(a[c])}else if(c&&(c.nodeType===1||c.nodeType===
3)||typeof c==="string"||typeof c==="number")b.push(c)}}}}function K(a){var b,d,c,i,n;i=[];d={};for(b=1;b<arguments.length;++b)G(this,i,d,arguments[b]);a=a.toLowerCase();if(j){if(document.attachEvent&&!E.opera&&(d.name||a=="input"&&d.type)){tag="<"+a;if(d.name)tag+=' name="'+d.name+'"';if(a=="input"&&d.type)tag+=' type="'+d.type+'"';tag+=">";delete d.name;delete d.type;n=document.createElement(tag)}else{m[a]||(m[a]=document.createElement(a));n=m[a].cloneNode(false)}e(n).attr(d);for(b=0;b<i.length;++b)i[b]&&
(i[b].nodeType===1||i[b].nodeType===3)?n.appendChild(i[b]):n.appendChild(document.createTextNode(String(i[b])))}else{n="<"+a;for(c in d)n+=" "+(z[c]||c)+'="'+d[c]+'"';if(i.length==0)n+=" />";else{n+=">";for(b=0;b<i.length;++b)n+=i[b];n+="</"+a+">"}}return n}function L(a){if(j){var b=K("div");b.innerHTML=a;return o(b.childNodes)}else return[a]}function M(a){for(var b=[],d=0;d<a.length;++d)if(u(a[d]))b=b.concat(M(a[d]));else b.push(a[d]);return b}function Q(a){return function(){for(var b=[a],d=0;d<
arguments.length;++d)b.push(arguments[d]);return K.apply(this,b)}}function N(a){for(var b in l)b in a||(a[b]=l[b])}function w(a,b){for(var d in b)a[d]=b[d];return a}function y(a){return a&&a.prototype&&a.prototype.initialize&&a.prototype.element}function C(a){return a&&typeof a=="object"&&"jquery"in a&&"length"in a}function r(a){return typeof a=="string"&&a.match(/^<[\w\W]+>/)}function A(a,b){if(typeof b!="string"||!a||!("constructor"in a&&"engine"in a.constructor))return false;return a.constructor.engine().detect(b)}
function u(a){return Object.prototype.toString.call(a)==="[object Array]"}function I(a,b){if(b.indexOf)return b.indexOf(a);for(var d=0,c=b.length;d<c;d++)if(b[d]===a)return d;return-1}function o(a){if(!a)return[];for(var b=a.length||0,d=Array(b);b--;)d[b]=a[b];return d}function v(a){for(var b=o(arguments).slice(1),d=[],c=0;c<a.length;c++)I(a[c],b)>-1||d.push(a[c]);return d}function t(a,b){if(b===q)return a;if(arguments.length<3)return function(){return a.apply(b,arguments)};else{var d=o(arguments);
d.shift();d.shift();return function(){return a.apply(b,d.concat(o(arguments)))}}}function f(a,b){return function(){return b.apply(this,[t(a,this)].concat(o(arguments)))}}function g(a){for(a=a;a.parentNode;)a=a.parentNode;return!!a.body}var j="fn"in e&&"jquery"in e.fn;if(j&&Number(e.fn.jquery.replace(/\./g))<143)throw"jQuery View requires jQuery 1.4.3 or later.";e.view=function(a,b){if(a==="engine")if(typeof b==="string")k=b;else{h[b.name]=b;k=b.name}else{var d=false;if(y(a)){d=a;if(arguments.length==
2&&typeof arguments[1]==="object"){b=arguments[1];if("initialize"in b){a=b.initialize;delete b.initialize}else a=function(){}}else{a=arguments[1];b=arguments[2]}}else if(b===q&&typeof a==="object")if("initialize"in a){b=a;a=b.initialize;delete b.initialize}else throw'"initialize" method must be specified to create a $.view class.';if(typeof a=="string"){var c=String(a);a=function(){return c}}var i=function D(x,R){this.length=0;this._element=null;this._delegates=[];this._observers={};this._attributes=
{};this._changes={};if(C(x))x=x[0];if(x&&typeof x==="object"&&x.nodeType===1){this.element(x);x=R||{}}this.attributes(x||{});this.template&&this.element(this.template);for(var F=0;F<this.constructor._methodsToProxy.length;++F)this[this.constructor._methodsToProxy[F]]=t(this[this.constructor._methodsToProxy[F]],this);e.view.logging&&console.log("jQuery.View: initialized ",this," with attributes:",x);(F=this.initialize(this.element()))&&!this._element&&this.element(F);if(j&&(!this._element||!this._element.nodeType||
this._element.nodeType!==1))throw"The view constructor must return either a DOM element or jQuery object, or call this.element() with a DOM element. View constructor returned:"+typeof this._element;this.trigger("initialized");D._observers&&"ready"in D._observers&&B(this)};i._methodsToProxy=[];for(var n in b)i._methodsToProxy.push(n);i._observers={};i._instance=false;w(i,e.view.classMethods);if(d){w(i.prototype,d.prototype);i.prototype.initialize=f(d.prototype.initialize,function(D){D=t(D,this)()||
this.element();return a.apply(this,[D])||this.element()||D});for(n=0;n<d._methodsToProxy.length;++n)i._methodsToProxy.push(d._methodsToProxy[n])}else{w(i.prototype,e.view.fn);i.prototype.initialize=a}i.prototype.bind=f(i.prototype.bind,P);if(d){i._observers={};for(var J in d._observers)i._observers[J]=d._observers[J];i.prototype._observers={};O(i,d)}w(i.prototype,b||{});return i}};e.view.classMethods={instance:function a(a){if(a===q){if(!this._instance)this._instance=new this}else this._instance=
a;return this._instance},bind:function(a,b){if(typeof a==="object"){var d={},c;for(c in a)d[c]=this.bind(c,a[c]);return d}else{d=o(arguments);if(d[2]===q)d[2]=this;b=t.apply(e.view,[b].concat(d.slice(2)));if(typeof a==="string"&&b!==q){a in this._observers||(this._observers[a]=[]);this._observers[a].push(b)}return b}},unbind:function(a,b){a in this._observers||(this._observers[a]=[]);if(a&&b)this._observers[a]=v(this._observers[a],b);else if(a)this._observers[a]=[];else this._observers={}},one:function(a,
b){var d=o(arguments);if(d[2]===q)d[2]=this;b=t.apply(e.view,[b].concat(d.slice(2)));var c=t(function(){var i=b.apply(this,arguments);this.unbind(a,c);return i},this);a in this._observers||(this._observers[a]=[]);this._observers[a].push(c);return c},trigger:function(a){if(!this._observers||!this._observers[a]||this._observers[a]&&this._observers[a].length==0)return[];a in this._observers||(this._observers[a]=[]);for(var b=[],d=o(arguments).slice(1),c=0;c<this._observers[a].length;++c){var i=this._observers[a][c].apply(this._observers[a][c],
d);if(i===false)return false;else b.push(i)}return b},ready:function(){var a=o(arguments);a.unshift("ready");return this.bind.apply(this,a)},engine:function a(a){if(a===q)return h[this._engine===q?k:this._engine];else this._engine=a}};e.view.fn={element:function a(a){if(a!==q){if(typeof a==="function")a=a.apply(this,[]);if(A(this,a))a=this.render(a);if(r(a))a=L(a)[0];else if(C(a))a=a[0];this._element=a;this.length=1;this[0]=this._element;if(this._delegates.length>0){for(var b=0;b<this._delegates.length;++b)this.delegate(this._delegates[b][0],
this._delegates[b][1],this._delegates[b][2]);this._delegates=[]}if(j)this.$=H(this)}return this._element},attributes:function a(a,b){if(a!==q){var d={},c;for(c in this._attributes)d[c]=true;for(c in a){delete d[c];this.set(c,a[c],true)}for(c in d){this._changes[c]=null;delete this._attributes[d[c]]}b===q&&this.trigger("change",this._changes,this);this._changes={}}return this._attributes},get:function(a){if(arguments.length>1||u(a)){var b=[],d;d=u(a)?a:o(arguments);for(var c=0;c<d.length;++c)b.push(this.get(d[c]));
return b}else if(typeof a==="string"||typeof a=="number")return this._attributes[a]},set:function(a,b,d){if(typeof a==="object"){var c=a;d=b;for(a in c){b=c[a];this._attributes[a]=b;this._changes[a]=b}if(d===q){this.trigger("change",this._changes);for(a in this._changes)this.trigger("change:"+a,this._changes[a]);this._changes={}}return c}else{this._attributes[a]=b;this._changes[a]=b;if(d===q){this.trigger("change:"+a,b);this.trigger("change",this._changes);this._changes={}}return b}},bind:e.view.classMethods.bind,
unbind:e.view.classMethods.unbind,one:e.view.classMethods.one,trigger:function(a){if((!this.constructor._observers||!this.constructor._observers[a]||this.constructor._observers[a]&&this.constructor._observers[a].length==0)&&(!this._observers||!this._observers[a]||this._observers[a]&&this._observers[a].length==0))return[];var b=o(arguments).slice(1),d=[];constructor_args=o(arguments).slice(1);constructor_args.unshift(this);constructor_args.unshift(a);var c=this.constructor.trigger.apply(this.constructor,
constructor_args);if(c===false)return false;d=d.concat(c);a in this._observers||(this._observers[a]=[]);for(var i=0;i<this._observers[a].length;++i){c=this._observers[a][i].apply(this._observers[a][i],b);if(c===false)return false;else d.push(c)}return d},ready:e.view.classMethods.ready,emit:function(){var a=o(arguments),b=this;return function(){return b.trigger.apply(b,a)}},map:function(a,b,d){d=d||[];if(typeof a==="string")a=this.get(a);if(u(a))for(var c=0;c<a.length;++c)d.push(b.apply(this,[a[c],
c]));else{c=0;for(var i in a){typeof a[i]==="function"?this.map(this.get(i),a[i],d):d.push(b.apply(this,[i,a[i],c]));++c}}return d},callback:function(a){var b=o(arguments).slice(1),d=this;return function(){typeof a==="string"?d[a].apply(d,b):a.apply(d,b);return false}},delegate:function(a,b,d,c){if(c)d=t(d,c);this._element?e(this._element).delegate(a,b,d):this._delegates.push([a,b,d])},escape:function(a){return document.createTextNode(a)},render:function(a,b){var d={},c;for(c in this)if(I(c,["_delegates",
"_observers","_attributes","_changes"])==-1)d[c]=this[c];w(d,this.attributes());w(d,b);return this.constructor.engine().render(a,d)}};e.view.logging=false;var h={},k;e.view("engine",{name:"jquery.tmpl",detect:function(a){return a.match(/\$\{[^\}]+\}/)},render:function(a,b){return e.tmpl(a,b)}});for(var l={},m={},p="a abbr acronym address applet area b base basefont bdo big blockquote body br button canvas caption center cite code col colgroup dd del dfn dir div dl dt em embed fieldset font form frame frameset h1 h2 h3 h4 h5 h6 head hr html i iframe img input ins isindex kbd label legend li link menu meta nobr noframes noscript object ol optgroup option p param pre q s samp script select small span strike strong style sub sup table tbody td textarea tfoot th thead title tr tt u ul var article aside audio command details figcaption figure footer header hgroup keygen mark meter nav output progress rp ruby section source summary time video".split(/\s+/),
z={htmlFor:"for",className:"class"},s=0;s<p.length;++s)l[p[s]]=Q(p[s]);N(e.view);N(e.view.fn);if(typeof module!=="undefined")module.exports.render=function(a,b){return(new e.view(new Function(a),b)).element()}})("jQuery"in this?jQuery:"Zepto"in this?Zepto:this,this);
