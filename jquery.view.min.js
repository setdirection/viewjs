(function(e){function E(f,g,i,h){h={data:h||(g?g.data:{}),_wrap:g?g._wrap:null,tmpl:null,parent:g||null,nodes:[],calls:K,nest:L,wrap:M,html:Q,update:N};f&&e.extend(h,f,{nodes:[],parent:g});if(i){h.tmpl=i;h._ctnt=h._ctnt||h.tmpl(e,h);h.key=++q;(t.length?A:r)[q]=h}return h}function o(f,g,i){var h;i=i?e.map(i,function(k){return typeof k==="string"?f.key?k.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+y+'="'+f.key+'" $2'):k:o(k,f,k._ctnt)}):f;if(g)return i;i=i.join("");i.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,
function(k,l,m,p){h=e(m).get();G(h);if(l)h=H(l).concat(h);if(p)h=h.concat(H(p))});return h?h:H(i)}function H(f){var g=document.createElement("div");g.innerHTML=f;return e.makeArray(g.childNodes)}function O(f){return new Function("jQuery","$item","var $=jQuery,call,_=[],$data=$item.data;with($data){_.push('"+e.trim(f).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,
function(g,i,h,k,l,m,p){g=e.tmpl.tag[h];if(!g)throw"Template command not found: "+h;h=g._default||[];if(m&&!/\w$/.test(l)){l+=m;m=""}if(l){l=B(l);p=p?","+B(p)+")":m?")":"";p=m?l.indexOf(".")>-1?l+B(m):"("+l+").call($item"+p:l;m=m?p:"(typeof("+l+")==='function'?("+l+").call($item):("+l+"))"}else m=p=h.$1||"null";k=B(k);return"');"+g[i?"close":"open"].split("$notnull_1").join(l?"typeof("+l+")!=='undefined' && ("+l+")!=null":"true").split("$1a").join(m).split("$1").join(p).split("$2").join(k||h.$2||
"")+"_.push('"})+"');}return _;")}function P(f,g){f._wrap=o(f,true,e.isArray(g)?g:[C.test(g)?g:e(g).html()]).join("")}function B(f){return f?f.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function G(f){function g(s){function a(n){n+=i;b=l[n]=l[n]||E(b,r[b.parent.key+i]||b.parent)}var c,d=s,b,j;if(j=s.getAttribute(y)){for(;d.parentNode&&(d=d.parentNode).nodeType===1&&!(c=d.getAttribute(y)););if(c!==j){d=d.parentNode?d.nodeType===11?0:d.getAttribute(y)||0:0;if(!(b=r[j])){b=A[j];b=E(b,r[d]||A[d]);
b.key=++q;r[q]=b}v&&a(j)}s.removeAttribute(y)}else if(v&&(b=e.data(s,"tmplItem"))){a(b.key);r[b.key]=b;d=(d=e.data(s.parentNode,"tmplItem"))?d.key:0}if(b){for(c=b;c&&c.key!=d;){c.nodes.push(s);c=c.parent}delete b._ctnt;delete b._wrap;e.data(s,"tmplItem",b)}}var i="_"+v,h,k,l={},m,p,z;m=0;for(p=f.length;m<p;m++)if((h=f[m]).nodeType===1){k=h.getElementsByTagName("*");for(z=k.length-1;z>=0;z--)g(k[z]);g(h)}}function K(f,g,i,h){if(!f)return t.pop();t.push({_:f,tmpl:g,item:this,data:i,options:h})}function L(f,
g,i){return e.tmpl(e.template(f),g,i,this)}function M(f,g){var i=f.options||{};i.wrapped=g;return e.tmpl(e.template(f.tmpl),f.data,i,f.item)}function Q(f,g){var i=this._wrap;return e.map(e(e.isArray(i)?i.join(""):i).filter(f||"*"),function(h){if(g)h=h.innerText||h.textContent;else{var k;if(!(k=h.outerHTML)){k=document.createElement("div");k.appendChild(h.cloneNode(true));k=k.innerHTML}h=k}return h})}function N(){var f=this.nodes;e.tmpl(null,null,null,this).insertBefore(f[0]);e(f).remove()}var w=e.fn.domManip,
y="_tmplitem",C=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,r={},A={},u,I={key:0,data:{}},q=0,v=0,t=[];e.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(f,g){e.fn[f]=function(i){var h=[];i=e(i);var k,l,m;k=this.length===1&&this[0].parentNode;u=r||{};if(k&&k.nodeType===11&&k.childNodes.length===1&&i.length===1){i[g](this[0]);h=this}else{l=0;for(m=i.length;l<m;l++){v=l;k=(l>0?this.clone(true):this).get();e(i[l])[g](k);h=h.concat(k)}v=0;
h=this.pushStack(h,f,i.selector)}i=u;u=null;e.tmpl.complete(i);return h}});e.fn.extend({tmpl:function(f,g,i){return e.tmpl(this[0],f,g,i)},tmplItem:function(){return e.tmplItem(this[0])},template:function(f){return e.template(f,this[0])},domManip:function(f,g,i){if(f[0]&&e.isArray(f[0])){for(var h=e.makeArray(arguments),k=f[0],l=k.length,m=0,p;m<l&&!(p=e.data(k[m++],"tmplItem")););if(p&&v)h[2]=function(z){e.tmpl.afterManip(this,z,i)};w.apply(this,h)}else w.apply(this,arguments);v=0;u||e.tmpl.complete(r);
return this}});e.extend({tmpl:function(f,g,i,h){var k=!h;if(k){h=I;f=e.template[f]||e.template(null,f);A={}}else if(!f){f=h.tmpl;r[h.key]=h;h.nodes=[];h.wrapped&&P(h,h.wrapped);return e(o(h,null,h.tmpl(e,h)))}if(!f)return[];if(typeof g==="function")g=g.call(h||{});i&&i.wrapped&&P(i,i.wrapped);g=e.isArray(g)?e.map(g,function(l){return l?E(i,h,f,l):null}):[E(i,h,f,g)];return k?e(o(h,null,g)):g},tmplItem:function(f){var g;if(f instanceof e)f=f[0];for(;f&&f.nodeType===1&&!(g=e.data(f,"tmplItem"))&&(f=
f.parentNode););return g||I},template:function(f,g){if(g){if(typeof g==="string")g=O(g);else if(g instanceof e)g=g[0]||{};if(g.nodeType)g=e.data(g,"tmpl")||e.data(g,"tmpl",O(g.innerHTML));return typeof f==="string"?e.template[f]=g:g}return f?typeof f!=="string"?e.template(null,f):e.template[f]||e.template(null,C.test(f)?f:e(f)):null},encode:function(f){return(""+f).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});e.extend(e.tmpl,{tag:{tmpl:{_default:{$2:"null"},
open:"if($notnull_1){_=_.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(_,$1,$2);_=[];",close:"call=$item.calls();_=call._.concat($item.wrap(call,_));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){_.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){_.push($.encode($1a));}"},
"!":{open:""}},complete:function(){r={}},afterManip:function(f,g,i){var h=g.nodeType===11?e.makeArray(g.childNodes):g.nodeType===1?[g]:[];i.call(f,g);G(h);v++}})})(jQuery);
(function(e,E,o){function H(a){return w(function(c){return e(c,a._element)},e(a._element))}function O(a,c){for(var d=["bind","unbind","one"],b=0;b<d.length;++b)(function(j){c[j]=f(c[j],function(n){var J=q(arguments).slice(1);a[j].apply(a,J);return n.apply(n,J)})})(d[b])}function P(a,c){var d=q(arguments).slice(1);d=a.apply(a,d);c=="ready"&&B(this);return d}function B(a){if(!a._readyEventFired&&a._element&&g(a._element)){a.trigger("ready");a._readyEventFired=true;a._readyEventInterval&&clearInterval(a._readyEventInterval)}else"_readyEventInterval"in
a||setTimeout(function(){if(a._element&&g(a._element)){a.trigger("ready");a._readyEventFired=true}else if(!a._readyEventInterval)a._readyEventInterval=setInterval(function(){try{if(a._element&&g(a._element)){a.trigger("ready");a._readyEventFired=true;clearInterval(a._readyEventInterval);a._readyEventInterval=false}}catch(c){clearInterval(a._readyEventInterval);throw c;}},10)})}function G(a,c,d,b){if(!(b===o||b===null||b===false)){if(typeof b==="function"&&!y(b))b=b();if(b&&b.element&&b.element().nodeType==
1&&b._attributes||typeof b.element=="function")c.push(b.element());else if(y(b))c.push((new b).element());else{if(typeof b==="function")b=b();if(typeof b!=="string"&&typeof b!=="number"&&!u(b)&&!C(b)&&!(b&&(b.nodeType===1||b.nodeType===3)))for(attribute_name in b)d[attribute_name]=b[attribute_name];else{if(A(a,b))b=a.render(b);if(C(b))b=b.toArray();if(u(b)){var j=M(b);for(b=0;b<j.length;++b)G(a,c,d,j[b])}else if(r(b)){a=L(b);for(b=0;b<a.length;++b)c.push(a[b])}else if(b&&(b.nodeType===1||b.nodeType===
3)||typeof b==="string"||typeof b==="number")c.push(b)}}}}function K(a){var c,d,b,j,n;j=[];d={};for(c=1;c<arguments.length;++c)G(this,j,d,arguments[c]);a=a.toLowerCase();if(i){if(document.attachEvent&&!E.opera&&(d.name||a=="input"&&d.type)){tag="<"+a;if(d.name)tag+=' name="'+d.name+'"';if(a=="input"&&d.type)tag+=' type="'+d.type+'"';tag+=">";delete d.name;delete d.type;n=document.createElement(tag)}else{m[a]||(m[a]=document.createElement(a));n=m[a].cloneNode(false)}e(n).attr(d);for(c=0;c<j.length;++c)j[c]&&
(j[c].nodeType===1||j[c].nodeType===3)?n.appendChild(j[c]):n.appendChild(document.createTextNode(String(j[c])))}else{n="<"+a;for(b in d)n+=" "+(z[b]||b)+'="'+d[b]+'"';if(j.length==0)n+=" />";else{n+=">";for(c=0;c<j.length;++c)n+=j[c];n+="</"+a+">"}}return n}function L(a){if(i){var c=K("div");c.innerHTML=a;return q(c.childNodes)}else return[a]}function M(a){for(var c=[],d=0;d<a.length;++d)if(u(a[d]))c=c.concat(M(a[d]));else c.push(a[d]);return c}function Q(a){return function(){for(var c=[a],d=0;d<
arguments.length;++d)c.push(arguments[d]);return K.apply(this,c)}}function N(a){for(var c in l)c in a||(a[c]=l[c])}function w(a,c){for(var d in c)a[d]=c[d];return a}function y(a){return a&&a.prototype&&a.prototype.initialize&&a.prototype.element}function C(a){return a&&typeof a=="object"&&"jquery"in a&&"length"in a}function r(a){return typeof a=="string"&&a.match(/^<[\w\W]+>/)}function A(a,c){if(typeof c!="string"||!a||!("constructor"in a&&"engine"in a.constructor))return false;return a.constructor.engine().detect(c)}
function u(a){return Object.prototype.toString.call(a)==="[object Array]"}function I(a,c){if(c.indexOf)return c.indexOf(a);for(var d=0,b=c.length;d<b;d++)if(c[d]===a)return d;return-1}function q(a){if(!a)return[];for(var c=a.length||0,d=Array(c);c--;)d[c]=a[c];return d}function v(a){for(var c=q(arguments).slice(1),d=[],b=0;b<a.length;b++)I(a[b],c)>-1||d.push(a[b]);return d}function t(a,c){if(c===o)return a;if(arguments.length<3)return function(){return a.apply(c,arguments)};else{var d=q(arguments);
d.shift();d.shift();return function(){return a.apply(c,d.concat(q(arguments)))}}}function f(a,c){return function(){return c.apply(this,[t(a,this)].concat(q(arguments)))}}function g(a){for(a=a;a.parentNode;)a=a.parentNode;return!!a.body}var i="fn"in e&&"jquery"in e.fn;if(i&&Number(e.fn.jquery.replace(/\./g))<143)throw"jQuery View requires jQuery 1.4.3 or later.";e.view=function(a,c){if(typeof this==="object"){var d=e.view();return new d(arguments[0],arguments[1])}if(a==="engine")if(typeof c==="string")k=
c;else{h[c.name]=c;k=c.name}else{var b=false;if(y(a)){b=a;if(arguments.length==2&&typeof arguments[1]==="object"){c=arguments[1];if("initialize"in c){a=c.initialize;delete c.initialize}else a=function(){}}else{a=arguments[1];c=arguments[2]}}else if(c===o&&typeof a==="object"){c=a;if("initialize"in c){a=c.initialize;delete c.initialize}else a=e.view.fn.initialize}else if(c===o&&a===o)a=e.view.fn.initialize;if(typeof a=="string"){var j=String(a);a=function(){return j}}d=function D(x,R){this.length=
0;this._element=null;this._delegates=[];this._observers={};this._attributes={};this._changes={};if(C(x))x=x[0];if(x&&typeof x==="object"&&x.nodeType===1){this.element(x);x=R||{}}this.attributes(x||{});this.template&&this.element(this.template);for(var F=0;F<this.constructor._methodsToProxy.length;++F)this[this.constructor._methodsToProxy[F]]=t(this[this.constructor._methodsToProxy[F]],this);e.view.logging&&console.log("jQuery.View: initialized ",this," with attributes:",x);(F=this.initialize(this.element()))&&
!this._element&&this.element(F);if(i&&(!this._element||!this._element.nodeType||this._element.nodeType!==1))throw"The view constructor must return either a DOM element or jQuery object, or call this.element() with a DOM element. View constructor returned:"+typeof this._element;this.trigger("initialized");D._observers&&"ready"in D._observers&&B(this)};d._methodsToProxy=[];for(var n in c)d._methodsToProxy.push(n);d._observers={};d._instance=false;w(d,e.view.classMethods);if(b){w(d.prototype,b.prototype);
d.prototype.initialize=f(b.prototype.initialize,function(D){D=t(D,this)()||this.element();return a.apply(this,[D])||this.element()||D});for(n=0;n<b._methodsToProxy.length;++n)d._methodsToProxy.push(b._methodsToProxy[n])}else{w(d.prototype,e.view.fn);d.prototype.initialize=a}d.prototype.bind=f(d.prototype.bind,P);if(b){d._observers={};for(var J in b._observers)d._observers[J]=b._observers[J];d.prototype._observers={};O(d,b)}w(d.prototype,c||{});return d}};e.view.classMethods={instance:function a(a){if(a===
o){if(!this._instance)this._instance=new this}else this._instance=a;return this._instance},bind:function(a,c){if(typeof a==="object"){var d={},b;for(b in a)d[b]=this.bind(b,a[b]);return d}else{d=q(arguments);if(d[2]===o)d[2]=this;c=t.apply(e.view,[c].concat(d.slice(2)));if(typeof a==="string"&&c!==o){a in this._observers||(this._observers[a]=[]);this._observers[a].push(c)}return c}},unbind:function(a,c){a in this._observers||(this._observers[a]=[]);if(a&&c)this._observers[a]=v(this._observers[a],
c);else if(a)this._observers[a]=[];else this._observers={}},one:function(a,c){var d=q(arguments);if(d[2]===o)d[2]=this;c=t.apply(e.view,[c].concat(d.slice(2)));var b=t(function(){var j=c.apply(this,arguments);this.unbind(a,b);return j},this);a in this._observers||(this._observers[a]=[]);this._observers[a].push(b);return b},trigger:function(a){if(!this._observers||!this._observers[a]||this._observers[a]&&this._observers[a].length==0)return[];a in this._observers||(this._observers[a]=[]);for(var c=
[],d=q(arguments).slice(1),b=0;b<this._observers[a].length;++b){var j=this._observers[a][b].apply(this._observers[a][b],d);if(j===false)return false;else c.push(j)}return c},ready:function(){var a=q(arguments);a.unshift("ready");return this.bind.apply(this,a)},engine:function a(a){if(a===o)return h[this._engine===o?k:this._engine];else this._engine=a}};e.view.fn={initialize:function(){return this.div()},element:function a(a){if(a!==o){if(typeof a==="function")a=a.apply(this,[]);if(A(this,a))a=this.render(a);
if(r(a))a=L(a)[0];else if(C(a))a=a[0];this._element=a;this.length=1;this[0]=this._element;if(this._delegates.length>0){for(var c=0;c<this._delegates.length;++c)this.delegate(this._delegates[c][0],this._delegates[c][1],this._delegates[c][2]);this._delegates=[]}if(i)this.$=H(this)}return this._element},attributes:function a(a,c){if(this.model)return this.model.attributes.apply(this.model,arguments);else{if(a!==o){var d={},b;for(b in this._attributes)d[b]=true;for(b in a){delete d[b];this.set(b,a[b],
true)}for(b in d){this._changes[b]=null;delete this._attributes[d[b]]}c===o&&this.trigger("change",this._changes,this);this._changes={}}return this._attributes}},get:function(a){if(arguments.length>1||u(a)){var c=[],d;d=u(a)?a:q(arguments);for(var b=0;b<d.length;++b)c.push(this.get(d[b]));return c}else if(typeof a==="string"||typeof a=="number")return this.model?this.model.get.apply(this.model,arguments):this._attributes[a]},set:function(a,c,d){if(typeof a==="object"){var b=arguments[0];d=arguments[1];
for(a in b){c=b[a];this._attributes[a]=c;this._changes[a]=c}if(d===o){this.trigger("change",this._changes);for(a in this._changes)this.trigger("change:"+a,this._changes[a]);this._changes={}}return b}else if(this.model)return this.model.set.apply(this.model,arguments);else{this._attributes[a]=c;this._changes[a]=c;if(d===o){this.trigger("change:"+a,c);this.trigger("change",this._changes);this._changes={}}return c}},bind:e.view.classMethods.bind,unbind:e.view.classMethods.unbind,one:e.view.classMethods.one,
trigger:function(a){if((!this.constructor._observers||!this.constructor._observers[a]||this.constructor._observers[a]&&this.constructor._observers[a].length==0)&&(!this._observers||!this._observers[a]||this._observers[a]&&this._observers[a].length==0))return[];var c=q(arguments).slice(1),d=[];constructor_args=q(arguments).slice(1);constructor_args.unshift(this);constructor_args.unshift(a);var b=this.constructor.trigger.apply(this.constructor,constructor_args);if(b===false)return false;d=d.concat(b);
a in this._observers||(this._observers[a]=[]);for(var j=0;j<this._observers[a].length;++j){b=this._observers[a][j].apply(this._observers[a][j],c);if(b===false)return false;else d.push(b)}return d},ready:e.view.classMethods.ready,map:function(a,c,d){d=d||[];if(typeof a==="string")a=this.get(a);if(u(a))for(var b=0;b<a.length;++b)d.push(c.apply(this,[a[b],b]));else{b=0;for(var j in a){typeof a[j]==="function"?this.map(this.get(j),a[j],d):d.push(c.apply(this,[j,a[j],b]));++b}}return d},callback:function(a){var c=
q(arguments).slice(1),d=this;return function(){typeof a==="string"?d[a].apply(d,c):a.apply(d,c);return false}},delegate:function(a,c,d,b){if(b)d=t(d,b);this._element?e(this._element).delegate(a,c,d):this._delegates.push([a,c,d])},escape:function(a){return document.createTextNode(a)},render:function(a,c){var d={},b;for(b in this)if(I(b,["_delegates","_observers","_attributes","_changes"])==-1)d[b]=this[b];w(d,this.attributes());w(d,c);return this.constructor.engine().render(a,d)}};e.view.logging=false;
var h={},k;e.view("engine",{name:"jquery.tmpl",detect:function(a){return a.match(/\$\{[^\}]+\}/)},render:function(a,c){return e.tmpl(a,c)}});for(var l={},m={},p="a abbr acronym address applet area b base basefont bdo big blockquote body br button canvas caption center cite code col colgroup dd del dfn dir div dl dt em embed fieldset font form frame frameset h1 h2 h3 h4 h5 h6 head hr html i iframe img input ins isindex kbd label legend li link menu meta nobr noframes noscript object ol optgroup option p param pre q s samp script select small span strike strong style sub sup table tbody td textarea tfoot th thead title tr tt u ul var article aside audio command details figcaption figure footer header hgroup keygen mark meter nav output progress rp ruby section source summary time video".split(/\s+/),
z={htmlFor:"for",className:"class"},s=0;s<p.length;++s)l[p[s]]=Q(p[s]);N(e.view);N(e.view.fn);if(typeof module!=="undefined")module.exports.render=function(a,c){return(new e.view(new Function(a),c)).element()}})("jQuery"in this?jQuery:"Zepto"in this?Zepto:this,this);
