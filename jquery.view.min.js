// jQuery View v1.0
// http://viewjs.com/
// 
// Copyright (c) 2011 Ryan Johnson
// http://syntacticx.com/
// 
// Dual licensed under the MIT or GPL Version 2 licenses.
(function(g){function F(a,b){for(var c=["bind","unbind","one"],d=0;d<c.length;++d)(function(e){b[e]=s(b[e],function(f){var h=i(arguments).slice(1);a[e].apply(a,h);return f.apply(f,h)})})(c[d])}function G(a,b){var c=i(arguments).slice(1);c=a.apply(a,c);b=="ready"&&z(this);return c}function z(a){if(!a._readyEventFired&&a._element&&t(a._element)){a.trigger("ready");a._readyEventFired=true;a._readyEventInterval&&clearInterval(a._readyEventInterval)}else"_readyEventInterval"in a||setTimeout(function(){if(a._element&&
t(a._element)){a.trigger("ready");a._readyEventFired=true}else a._readyEventInterval=setInterval(function(){if(a._element&&t(a._element)){a.trigger("ready");a._readyEventFired=true;clearInterval(a._readyEventInterval);a._readyEventInterval=false}},10)})}function A(a,b,c,d){if(!(typeof d==="undefined"||d===null||d===false)){if(typeof d==="function"&&!u(d))d=d();if(d&&d.element&&d.element().nodeType==1&&d._attributes||typeof d.element=="function")b.push(d.element());else if(u(d))b.push((new d).element());
else{if(typeof d==="function")d=d();if(typeof d!=="string"&&typeof d!=="number"&&!p(d)&&!v(d)&&!(d&&d.nodeType===1))for(attribute_name in d)c[attribute_name]=d[attribute_name];else{if(v(d))d=d.toArray();if(p(d)){var e=B(d);for(d=0;d<e.length;++d)A(a,b,c,e[d])}else{if(C(a,d))d=a.render(d);if(D(d)){a=o?g(d):[d];for(d=0;d<a.length;++d)b.push(a[d])}else if(d&&d.nodeType===1||typeof d==="string"||typeof d==="number")b.push(d)}}}}}function H(a){var b,c,d,e,f;e=[];c={};for(b=1;b<arguments.length;++b)A(this,
e,c,arguments[b]);a=a.toLowerCase();if(o){if(document.attachEvent&&!window.opera&&(c.name||a=="input"&&c.type)){tag="<"+a;if(c.name)tag+=' name="'+c.name+'"';if(a=="input"&&c.type)tag+=' type="'+c.type+'"';tag+=">";delete c.name;delete c.type;f=document.createElement(tag)}else{w[a]||(w[a]=document.createElement(a));f=w[a].cloneNode(false)}g(f).attr(c);for(b=0;b<e.length;++b)e[b]&&e[b].nodeType===1?f.appendChild(e[b]):f.appendChild(document.createTextNode(String(e[b])))}else{f="<"+a;for(d in c)f+=
" "+(I[d]||d)+'="'+c[d]+'"';if(e.length==0)f+=" />";else{f+=">";for(b=0;b<e.length;++b)f+=e[b];f+="</"+a+">"}}return f}function B(a){for(var b=[],c=0;c<a.length;++c)if(p(a[c]))b=b.concat(B(a[c]));else b.push(a[c]);return b}function J(a){return function(){for(var b=[a],c=0;c<arguments.length;++c)b.push(arguments[c]);return H.apply(this,b)}}function E(a){for(var b in x)b in a||(a[b]=x[b])}function n(a,b){for(var c in b)a[c]=b[c];return a}function u(a){return a&&a.prototype&&a.prototype._structure&&
a.prototype.element}function v(a){return typeof a=="object"&&"jquery"in a&&"length"in a}function D(a){return typeof a=="string"&&a.match(/^<[\w\W]+>/)}function C(a,b){if(typeof b!="string"||!a||!("engine"in a))return false;var c=a.engine();if(c=="mustache")return b.match(/\{\{[^\}]+\}\}/);else if(c=="jquery.tmpl")return b.match(/\$\{[^\}]+\}/)}function p(a){return Object.prototype.toString.call(a)==="[object Array]"}function i(a){if(!a)return[];for(var b=a.length||0,c=Array(b);b--;)c[b]=a[b];return c}
function K(a){for(var b=i(arguments).slice(1),c=[],d=0;d<a.length;d++){var e;a:{e=a[d];var f=b;if(f.indexOf)e=f.indexOf(e);else{for(var h=0,k=f.length;h<k;h++)if(f[h]===e){e=h;break a}e=-1}}e>-1||c.push(a[d])}return c}function m(a,b){if(typeof b=="undefined")return a;if(arguments.length<3)return function(){return a.apply(b,arguments)};else{var c=i(arguments);c.shift();c.shift();return function(){return a.apply(b,c.concat(i(arguments)))}}}function s(a,b){return function(){return b.apply(this,[m(a,
this)].concat(i(arguments)))}}function t(a){for(a=a;a.parentNode;)a=a.parentNode;return!!a.body}var o="fn"in g&&"jquery"in g.fn;if(o&&Number(g.fn.jquery.replace(/\./g))<143)throw"jQuery View requires jQuery 1.4.3 or later.";g.view=function(a,b,c){var d;if(u(a)){d=a;a=b;b=c}if(typeof a=="string"){var e=String(a);a=function(){return e}}c=function k(){this.engine(g.view.defaultEngine);this._delegates=[];this._observers={};this._attributes={};this._changes={};for(var j=0;j<this.constructor._methodsToProxy.length;++j)this[this.constructor._methodsToProxy[j]]=
m(this[this.constructor._methodsToProxy[j]],this);this.initialize.apply(this,arguments);k._observers&&"ready"in k._observers&&z(this)};c._methodsToProxy=[];for(var f in b)c._methodsToProxy.push(f);c._observers={};c._instance=false;n(c,g.view.classMethods);if(d){n(c.prototype,d.prototype);c.prototype._structure=s(d.prototype._structure,function(k){return a.apply(this,[m(k,this)()])});for(f=0;f<d._methodsToProxy.length;++f)c._methodsToProxy.push(d._methodsToProxy[f])}else{n(c.prototype,g.view.fn);c.prototype._structure=
a}c.prototype.bind=s(c.prototype.bind,G);if(d){c._observers={};for(var h in d._observers)c._observers[h]=d._observers[h];c.prototype._observers={};F(c,d)}n(c.prototype,b||{});return c};g.view.classMethods={instance:function a(a){if(typeof a=="undefined"){if(!this._instance)this._instance=new this}else this._instance=a;return this._instance},bind:function(a,b){var c=i(arguments);if(typeof c[2]=="undefined")c[2]=this;b=m.apply(g.view,[b].concat(c.slice(2)));if(typeof a==="string"&&typeof b!=="undefined"){a in
this._observers||(this._observers[a]=[]);this._observers[a].push(b)}return b},unbind:function(a,b){a in this._observers||(this._observers[a]=[]);if(a&&b)this._observers[a]=K(this._observers[a],b);else if(a)this._observers[a]=[];else this._observers={}},one:function(a,b){var c=i(arguments);if(typeof c[2]=="undefined")c[2]=this;b=m.apply(g.view,[b].concat(c.slice(2)));var d=m(function(){var e=b.apply(this,arguments);this.unbind(a,d);return e},this);a in this._observers||(this._observers[a]=[]);this._observers[a].push(d);
return d},trigger:function(a){if(!this._observers||!this._observers[a]||this._observers[a]&&this._observers[a].length==0)return[];a in this._observers||(this._observers[a]=[]);for(var b=[],c=i(arguments).slice(1),d=0;d<this._observers[a].length;++d){var e=this._observers[a][d].apply(this._observers[a][d],c);if(e===false)return false;else b.push(e)}return b},ready:function(){var a=i(arguments);a.unshift("ready");return this.bind.apply(this,a)}};g.view.fn={initialize:function(a){this.length=0;g.view.logging&&
console.log("jQuery.View: initialized ",this," with attributes:",a);this.attributes(a||{});(a=this._structure())&&!this._element&&this.element(a);if(o&&(!this._element||!this._element.nodeType||this._element.nodeType!==1))throw"The view constructor must return either a DOM element or jQuery object, or call this.element() with a DOM element. View constructor returned:"+typeof this._element;this.trigger("initialized")},element:function a(a){if(typeof a!="undefined"){if(C(this,a))a=this.render(a);if(D(a))a=
o?g(a)[0]:a;else if(v(a))a=a[0];this._element=a;this.length=1;this[0]=this._element;if(this._delegates.length>0){for(var b=0;b<this._delegates.length;++b)this.delegate(this._delegates[b][0],this._delegates[b][1],this._delegates[b][2]);this._delegates=[]}}return this._element},attributes:function a(a,b){if(typeof a!="undefined"){for(var c in a)this.set(c,a[c],true);typeof b=="undefined"&&this.trigger("changed",this._changes,this);this._changes={}}return this._attributes},get:function(a){return this._attributes[a]},
set:function(a,b,c){this._attributes[a]=b;this._changes[a]=b;if(typeof c=="undefined"){this.trigger("changed",this._changes);this._changes={}}return b},bind:g.view.classMethods.bind,unbind:g.view.classMethods.unbind,one:g.view.classMethods.one,trigger:function(a){if((!this.constructor._observers||!this.constructor._observers[a]||this.constructor._observers[a]&&this.constructor._observers[a].length==0)&&(!this._observers||!this._observers[a]||this._observers[a]&&this._observers[a].length==0))return[];
var b=i(arguments).slice(1),c=[];constructor_args=i(arguments).slice(1);constructor_args.unshift(this);constructor_args.unshift(a);var d=this.constructor.trigger.apply(this.constructor,constructor_args);if(d===false)return false;c=c.concat(d);a in this._observers||(this._observers[a]=[]);for(var e=0;e<this._observers[a].length;++e){d=this._observers[a][e].apply(this._observers[a][e],b);if(d===false)return false;else c.push(d)}return c},ready:g.view.classMethods.ready,emit:function(){var a=i(arguments);
return m(function(){return this.trigger.apply(this,a)},this)},map:function(a,b){var c=[],d;if(p(a))for(var e=0;e<a.length;++e){d=b.apply(this,[a[e],e]);c.push(d)}else for(e in a){d=b.apply(this,[e,a[e]]);c.push(d)}return c},delegate:function(a,b,c,d){if(d)c=m(c,d);this._element?g(this._element).delegate(a,b,c):this._delegates.push([a,b,c])},escape:function(a){a=String(a===null?"":a);a=a.replace(/&(?!\w+;)|["'<>\\]/g,function(b){switch(b){case "&":return"&amp;";case "\\":return"\\\\";case '"':return"&quot;";
case "'":return"&#39;";case "<":return"&lt;";case ">":return"&gt;";default:return b}});return a.replace(/\{\{/,"\\{\\{").replace(/\}\}/,"\\}\\}")},render:function(a,b){var c=this.engine(),d={},e;for(e in this)if(Object.prototype.hasOwnProperty.call(this,e))d[e]=this[e];n(d,this.attributes());n(d,b);if(c=="mustache")return L.to_html(a,d);else if(c=="jquery.tmpl")return g(a).tmpl(d)},engine:function a(a){if(typeof a=="undefined")return this._engine;else{if(a!="mustache"&&a!="jquery.tmpl")throw a+" is not a supported template engine.";
if(a=="jquery.tmpl"&&!("tmpl"in g))throw"the jQuery Template engine requires the jQuery Templates plugin: https://github.com/jquery/jquery-tmpl";this._engine=a}}};g.view.logging=false;g.view.defaultEngine="mustache";for(var x={},w={},y="a abbr acronym address applet area b base basefont bdo big blockquote body br button canvas caption center cite code col colgroup dd del dfn dir div dl dt em embed fieldset font form frame frameset h1 h2 h3 h4 h5 h6 head hr html i iframe img input ins isindex kbd label legend li link menu meta nobr noframes noscript object ol optgroup option p param pre q s samp script select small span strike strong style sub sup table tbody td textarea tfoot th thead title tr tt u ul var article aside audio command details figcaption figure footer header hgroup keygen mark meter nav output progress rp ruby section source summary time video".split(/\s+/),
I={htmlFor:"for",className:"class"},q=0;q<y.length;++q)x[y[q]]=J(y[q]);E(g.view);E(g.view.fn);var L=function(){var a=function(){};a.prototype={otag:"{{",ctag:"}}",pragmas:{},buffer:[],pragmas_implemented:{"IMPLICIT-ITERATOR":true},context:{},render:function(b,c,d,e){if(!e){this.context=c;this.buffer=[]}if(!this.includes("",b))if(e)return b;else{this.send(b);return}b=this.render_pragmas(b);b=this.render_section(b,c,d);if(e)return this.render_tags(b,c,d,e);this.render_tags(b,c,d,e)},send:function(b){b!=
""&&this.buffer.push(b)},render_pragmas:function(b){if(!this.includes("%",b))return b;var c=this;return b.replace(RegExp(this.otag+"%([\\w-]+) ?([\\w]+=[\\w]+)?"+this.ctag),function(d,e,f){if(!c.pragmas_implemented[e])throw{message:"This implementation of mustache doesn't understand the '"+e+"' pragma"};c.pragmas[e]={};if(f){d=f.split("=");c.pragmas[e][d[0]]=d[1]}return""})},render_partial:function(b,c,d){b=this.trim(b);if(!d||d[b]===undefined)throw{message:"unknown_partial '"+b+"'"};if(typeof c[b]!=
"object")return this.render(d[b],c,d,true);return this.render(d[b],c[b],d,true)},render_section:function(b,c,d){if(!this.includes("#",b)&&!this.includes("^",b))return b;var e=this;return b.replace(RegExp(this.otag+"(\\^|\\#)\\s*(.+)\\s*"+this.ctag+"\n*([\\s\\S]+?)"+this.otag+"\\/\\s*\\2\\s*"+this.ctag+"\\s*","mg"),function(f,h,k,j){f=e.find(k,c);if(h=="^")return!f||e.is_array(f)&&f.length===0?e.render(j,c,d,true):"";else if(h=="#")return e.is_array(f)?e.map(f,function(l){return e.render(j,e.create_context(l),
d,true)}).join(""):e.is_object(f)?e.render(j,e.create_context(f),d,true):typeof f==="function"?f.call(c,j,function(l){return e.render(l,c,d,true)}):f?e.render(j,c,d,true):""})},render_tags:function(b,c,d,e){var f=this,h=function(){return RegExp(f.otag+"(=|!|>|\\{|%)?([^\\/#\\^]+?)\\1?"+f.ctag+"+","g")},k=h(),j=function(N,M,r){switch(M){case "!":return"";case "=":f.set_delimiters(r);k=h();return"";case ">":return f.render_partial(r,c,d);case "{":return f.find(r,c);default:return f.escape(f.find(r,
c))}};b=b.split("\n");for(var l=0;l<b.length;l++){b[l]=b[l].replace(k,j,this);e||this.send(b[l])}if(e)return b.join("\n")},set_delimiters:function(b){b=b.split(" ");this.otag=this.escape_regex(b[0]);this.ctag=this.escape_regex(b[1])},escape_regex:function(b){if(!arguments.callee.sRE)arguments.callee.sRE=RegExp("(\\/|\\.|\\*|\\+|\\?|\\||\\(|\\)|\\[|\\]|\\{|\\}|\\\\)","g");return b.replace(arguments.callee.sRE,"\\$1")},find:function(b,c){b=this.trim(b);var d;if(c[b]===false||c[b]===0||c[b])d=c[b];else if(this.context[b]===
false||this.context[b]===0||this.context[b])d=this.context[b];if(typeof d==="function")return d.apply(c);if(d!==undefined)return d;return""},includes:function(b,c){return c.indexOf(this.otag+b)!=-1},escape:function(b){b=String(b===null?"":b);return b.replace(/&(?!\w+;)|["'<>\\]/g,function(c){switch(c){case "&":return"&amp;";case "\\":return"\\\\";case '"':return"&quot;";case "'":return"&#39;";case "<":return"&lt;";case ">":return"&gt;";default:return c}})},create_context:function(b){if(this.is_object(b))return b;
else{var c=".";if(this.pragmas["IMPLICIT-ITERATOR"])c=this.pragmas["IMPLICIT-ITERATOR"].iterator;var d={};d[c]=b;return d}},is_object:function(b){return b&&typeof b=="object"},is_array:function(b){return Object.prototype.toString.call(b)==="[object Array]"},trim:function(b){return b.replace(/^\s*|\s*$/g,"")},map:function(b,c){if(typeof b.map=="function")return b.map(c);else{for(var d=[],e=b.length,f=0;f<e;f++)d.push(c(b[f]));return d}}};return{name:"mustache.js",version:"0.3.1-dev",to_html:function(b,
c,d,e){var f=new a;if(e)f.send=e;f.render(b,c,d);if(!e)return f.buffer.join("\n")}}}()})("jQuery"in this?jQuery:this);
